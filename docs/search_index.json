[["index.html", "Earth Hologenome Initiative | Lauritsen et al. 2024 Robust, open-source, and automation-friendly DNA extraction protocol for hologenomic research 1 Introduction 1.1 Prepare the R environment", " Earth Hologenome Initiative | Lauritsen et al. 2024 Robust, open-source, and automation-friendly DNA extraction protocol for hologenomic research Jonas G. Laurisen, Christian Carøe, Nanna Gaun, Garazi Martin, Aoife Leonard, Raphael Eisenhofer, M Thomas P Gilbert, Ostaizka Aizpurua, Antton Alberdi1, Carlotta Pietroni 2024-06-04 1 Introduction This webbook contains all the code used for the comparative study on the generation of metagenomic data from faeces of various species using three extraction methods. 1.1 Prepare the R environment 1.1.1 Environment To reproduce all the analyses locally, clone this repository in your computer using: RStudio &gt; New Project &gt; Version Control &gt; Git And indicating the following git repository: https://github.com/earthhologenome/EHI_extraction_test.git Once the R project has been created, follow the instructions and code chunks shown in this webbook. 1.1.2 Libraries The following R packages are required for the data analysis. # Base library(R.utils) library(knitr) library(tidyverse) library(rairtable) library(devtools) library(tinytable) library(broom) library(broom.mixed) # For tree handling library(ape) library(phyloseq) library(phytools) # For plotting library(ggplot2) library(ggrepel) library(ggpubr) library(ggnewscale) library(gridExtra) library(ggtreeExtra) library(ggtree) library(ggh4x) # For statistics library(spaa) library(vegan) library(Rtsne) library(geiger) library(hilldiv2) library(distillR) library(ANCOMBC) library(lme4) 1.1.3 Color codes vertebrate_colors &lt;- c(`Calotriton asper`=&quot;#157a73&quot;, `Lissotriton helveticus`=&quot;#47bfb6&quot;, `Salamandra atra`=&quot;#92d4d1&quot;, `Chalcides striatus`=&quot;#4a7015&quot;, `Natrix astreptophora`=&quot;#7ea845&quot;, `Podarcis muralis`=&quot;#b9d98d&quot;, `Plecotus auritus`=&quot;#5e1717&quot;, `Sciurus carolinensis`=&quot;#aa3333&quot;, `Trichosurus vulpecula`=&quot;#bf7777&quot;, `Geospizopsis unicolor`=&quot;#9e6b24&quot;, `Perisoreus infaustus`=&quot;#dba55a&quot;, `Zonotrichia capensis`=&quot;#dbbd93&quot;, `Extraction control`=&quot;#7a7a7a&quot;, `Library control`=&quot;#4a4a4a&quot;) University of Copenhagen, antton.alberdi@sund.ku.dk↩︎ "],["laboratory-performance.html", "2 Laboratory performance 2.1 Load data 2.2 DNA yield 2.3 Library performance", " 2 Laboratory performance 2.1 Load data Load data previously compiled from the database: all_data &lt;- read_tsv(&quot;data/all_data.tsv&quot;) %&gt;% mutate(Taxon=factor(Taxon,levels=c(&quot;Amphibian&quot;, &quot;Reptile&quot;, &quot;Mammal&quot;, &quot;Bird&quot;, &quot;Control&quot;))) %&gt;% mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;, &quot;DREX&quot;, &quot;EHEX&quot;))) %&gt;% mutate(Species=factor(Species,levels=c(&quot;Calotriton asper&quot;, &quot;Lissotriton helveticus&quot;, &quot;Salamandra atra&quot;, &quot;Chalcides striatus&quot;, &quot;Natrix astreptophora&quot;, &quot;Podarcis muralis&quot;, &quot;Plecotus auritus&quot;, &quot;Sciurus carolinensis&quot;, &quot;Trichosurus vulpecula&quot;, &quot;Geospizopsis unicolor&quot;, &quot;Perisoreus infaustus&quot;, &quot;Zonotrichia capensis&quot;, &quot;Extraction control&quot;, &quot;Library control&quot;))) 2.2 DNA yield Total amount of DNA extracted from the 150 ul subset of the bead-beaten sample. all_data %&gt;% select(Extraction,extract,Taxon) %&gt;% group_by(Taxon,Extraction) %&gt;% summarise(value = sprintf(&quot;%.0f±%.0f&quot;, mean(extract), sd(extract))) %&gt;% pivot_wider(names_from = Extraction, values_from = value) %&gt;% tt(caption = &quot;Mean and standard deviation of total DNA nanograms&quot;) tinytable_b3r8cwpe9ftynzx2uzv8 .table td.tinytable_css_d5lhmm9ku0afq6a3gv7t, .table th.tinytable_css_d5lhmm9ku0afq6a3gv7t { border-bottom: solid 0.1em #d3d8dc; } Mean and standard deviation of total DNA nanograms Taxon ZYMO DREX EHEX Amphibian 471±347 482±546 1733±1145 Reptile 102±68 162±128 250±171 Mammal 445±394 265±214 904±672 Bird 73±127 13±12 54±45 Control 0±0 2±3 1±0 all_data %&gt;% select(Library,Species,Extraction,extract,Taxon) %&gt;% unique() %&gt;% ggplot(aes(x=Extraction, y=extract, color=Species, group=Extraction))+ geom_boxplot(outlier.shape = NA, fill=&quot;#f4f4f4&quot;, color=&quot;#8c8c8c&quot;) + geom_jitter() + scale_color_manual(values=vertebrate_colors) + facet_grid(. ~ Taxon, scales = &quot;free&quot;) + theme_minimal() + labs(y=&quot;DNA yield (ng)&quot;,x=&quot;Extraction method&quot;) all_data %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% lmerTest::lmer(extract ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_1tkcrx586g2ykp4toah4 .table td.tinytable_css_56an158rh8g1zhfralh8, .table th.tinytable_css_56an158rh8g1zhfralh8 { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 160.36395 125.49705 1.2778304 16.14808 2.193741e-01 fixed NA ExtractionDREX -39.65796 74.42689 -0.5328445 153.24421 5.949131e-01 fixed NA ExtractionEHEX 580.62175 74.78157 7.7642359 153.30986 1.088065e-12 ran_pars Sample sd__(Intercept) 164.00812 NA NA NA NA ran_pars Species sd__(Intercept) 374.85139 NA NA NA NA ran_pars Residual sd__Observation 400.80106 NA NA NA NA DNA yields vary across host taxa. - Amphibians and mammals yield the highest total amounts of DNA. - Birds yield the lowest amounts of DNA. - Controls yield barely quantifiable DNA. EHEX yields highest amounts of total DNA. - DNA recovery raks of extraction methods are maintained across taxa. 2.3 Library performance Number of PCR cycles required for reaching the plateau phase of the indexing PCR. A higher number indicates a lower amount of amplifiable library template. When weighed by the input DNA, the required number of PCR cycles serves as an estimator of library performance. all_data %&gt;% group_by(Taxon,Extraction) %&gt;% summarise(value = sprintf(&quot;%.1f±%.1f&quot;, mean(pcr), sd(pcr))) %&gt;% pivot_wider(names_from = Extraction, values_from = value) %&gt;% tt(caption = &quot;Mean and standard deviation of optimal number of PCR cycles&quot;) tinytable_m8jxwpsfyccjgns3esk3 .table td.tinytable_css_l3dk34qjm0stfthbmmgo, .table th.tinytable_css_l3dk34qjm0stfthbmmgo { border-bottom: solid 0.1em #d3d8dc; } Mean and standard deviation of optimal number of PCR cycles Taxon ZYMO DREX EHEX Amphibian 14.3±1.6 10.7±2.9 10.7±2.3 Reptile 11.7±4.0 10.3±3.5 12.0±3.3 Mammal 11.1±3.5 9.9±1.9 10.0±2.1 Bird 17.6±2.8 18.7±4.3 14.4±2.3 Control 20.0±2.8 19.8±0.5 22.0±4.2 all_data %&gt;% select(Library,Species,Extraction,pcr,Taxon) %&gt;% unique() %&gt;% ggplot(aes(x=Extraction,y=pcr, color=Species, group=Extraction))+ scale_y_reverse() + geom_boxplot(outlier.shape = NA, fill=&quot;#f4f4f4&quot;, color=&quot;#8c8c8c&quot;) + geom_jitter() + scale_color_manual(values=vertebrate_colors) + facet_grid(. ~ Taxon, scales = &quot;free&quot;) + theme_minimal() + labs(y=&quot;Optimal number of PCR cycles&quot;,x=&quot;Extraction method&quot;) all_data %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% lmerTest::lmer(pcr ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_zmthpum231dnw1miic5u .table td.tinytable_css_lmiqvyke3ge68k7aecal, .table th.tinytable_css_lmiqvyke3ge68k7aecal { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 13.862035 0.8648942 16.027435 14.90821 8.328452e-11 fixed NA ExtractionDREX -1.568966 0.5106532 -3.072468 150.76244 2.519836e-03 fixed NA ExtractionEHEX -2.091261 0.5130831 -4.075872 150.84234 7.389947e-05 ran_pars Sample sd__(Intercept) 1.068964 NA NA NA NA ran_pars Species sd__(Intercept) 2.599229 NA NA NA NA ran_pars Residual sd__Observation 2.749952 NA NA NA NA "],["sequencing-data.html", "3 Sequencing data 3.1 Sequencing depth 3.2 Quality-filtering", " 3 Sequencing data 3.1 Sequencing depth tibble(metric=c(&quot;Total GB&quot;, &quot;Total reads&quot;, &quot;Average GB&quot;, &quot;Average reads&quot;), value=unlist(c(round(all_data %&gt;% summarise(sum(bases_pre_fastp)) / 1000000000,2), round(all_data %&gt;% summarise(sum(bases_pre_fastp)) / 300,2), paste0(round(all_data %&gt;% summarise(mean(bases_pre_fastp)) / 1000000000,2),&quot;±&quot;,round(all_data %&gt;% summarise(sd(bases_pre_fastp)) / 1000000000,2)), paste0(round(all_data %&gt;% summarise(mean(bases_pre_fastp)) / 300,0),&quot;±&quot;,round(all_data %&gt;% summarise(sd(bases_pre_fastp)) / 300,0)))) ) %&gt;% tt() tinytable_22phca5lqtoxf6vp2bs4 .table td.tinytable_css_1iuwtci9f07d01aqguo1, .table th.tinytable_css_1iuwtci9f07d01aqguo1 { border-bottom: solid 0.1em #d3d8dc; } metric value Total GB 937.37 Total reads 3124578099 Average GB 5.18±2.46 Average reads 17262862±8195554 all_data %&gt;% group_by(Taxon,Extraction) %&gt;% summarise(value = sprintf(&quot;%.1f±%.1f&quot;, mean(bases_post_fastp / 1000000000), sd(bases_post_fastp / 1000000000))) %&gt;% pivot_wider(names_from = Extraction, values_from = value) %&gt;% tt(caption = &quot;Mean and standard deviation of sequencing depth (GB)&quot;) tinytable_u5z5i4ahkbwpo2xh3ryy .table td.tinytable_css_0mpjdswy6k6w53ht2xmo, .table th.tinytable_css_0mpjdswy6k6w53ht2xmo { border-bottom: solid 0.1em #d3d8dc; } Mean and standard deviation of sequencing depth (GB) Taxon ZYMO DREX EHEX Amphibian 4.0±1.6 3.2±2.1 4.7±0.3 Reptile 6.1±2.2 5.7±1.3 5.0±1.8 Mammal 5.4±3.2 4.6±2.0 3.8±2.2 Bird 3.9±1.8 4.2±2.4 3.1±1.9 Control 0.0±0.0 0.5±0.6 2.1±2.7 all_data %&gt;% select(Library,Species,Extraction,bases_pre_fastp,Taxon) %&gt;% mutate(bases_pre_fastp=bases_pre_fastp/1000000000) %&gt;% unique() %&gt;% ggplot(aes(x=Extraction,y=bases_pre_fastp, color=Species, group=Extraction)) + geom_boxplot(outlier.shape = NA, fill=&quot;#f4f4f4&quot;, color=&quot;#8c8c8c&quot;) + geom_jitter() + scale_color_manual(values=vertebrate_colors) + facet_grid(. ~ Taxon, scales = &quot;free&quot;) + theme_minimal() + labs(y=&quot;Sequencing depth (Gb)&quot;,x=&quot;Extraction method&quot;) all_data %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% lmerTest::lmer(bases_post_fastp ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_ruzsab9tfj2udsw4p1ql .table td.tinytable_css_5kf38ib5rabmbe4oon15, .table th.tinytable_css_5kf38ib5rabmbe4oon15 { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 4808156823 382290022 12.577249 1.711860e+01 4.477658e-10 fixed NA ExtractionDREX -485437083 283030980 -1.715138 4.392525e+21 8.632000e-02 fixed NA ExtractionEHEX -474572486 284400639 -1.668676 1.443430e+09 9.518163e-02 ran_pars Sample sd__(Intercept) 1407267695 NA NA NA NA ran_pars Species sd__(Intercept) 508228832 NA NA NA NA ran_pars Residual sd__Observation 1524168473 NA NA NA NA 3.2 Quality-filtering all_data %&gt;% mutate(qf_bases=bases_post_fastp/bases_pre_fastp*100) %&gt;% group_by(Taxon,Extraction) %&gt;% summarise(value = sprintf(&quot;%.1f±%.1f&quot;, mean(qf_bases), sd(qf_bases))) %&gt;% pivot_wider(names_from = Extraction, values_from = value) %&gt;% tt(caption = &quot;Mean and standard deviation of quality-filtered proportion of reads&quot;) tinytable_io3vh2vpezfhx7lx22uw .table td.tinytable_css_qmu518c9k0ulet8wy0lf, .table th.tinytable_css_qmu518c9k0ulet8wy0lf { border-bottom: solid 0.1em #d3d8dc; } Mean and standard deviation of quality-filtered proportion of reads Taxon ZYMO DREX EHEX Amphibian 84.7±1.2 91.7±3.7 87.6±2.9 Reptile 89.9±6.3 90.5±7.1 88.3±7.2 Mammal 91.9±2.3 89.5±4.7 91.2±1.9 Bird 70.9±16.1 70.3±23.0 70.2±14.7 Control 3.3±2.3 9.8±11.5 27.5±3.4 all_data %&gt;% mutate(qf_bases=bases_post_fastp/bases_pre_fastp*100) %&gt;% select(Library,Species,Extraction,qf_bases,Taxon) %&gt;% unique() %&gt;% ggplot(aes(x=Extraction,y=qf_bases, color=Species, group=Extraction)) + geom_boxplot(outlier.shape = NA, fill=&quot;#f4f4f4&quot;, color=&quot;#8c8c8c&quot;) + geom_jitter() + scale_color_manual(values=vertebrate_colors) + facet_grid(. ~ Taxon, scales = &quot;free&quot;) + theme_minimal() + labs(y=&quot;High-quality data (%)&quot;,x=&quot;Extraction method&quot;) all_data %&gt;% mutate(qf_bases=bases_post_fastp/bases_pre_fastp*100) %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% lmerTest::lmer(qf_bases ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_5m1xqtmdipuzprxp5niz .table td.tinytable_css_ylt6ym5aw5bbix3ni8m9, .table th.tinytable_css_ylt6ym5aw5bbix3ni8m9 { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 83.056667 3.229677 25.7167105 12.92142 1.758335e-12 fixed NA ExtractionDREX 1.811218 1.262245 1.4349184 145.69071 1.534536e-01 fixed NA ExtractionEHEX 0.572778 1.268390 0.4515789 145.71392 6.522438e-01 ran_pars Sample sd__(Intercept) 7.418800 NA NA NA NA ran_pars Species sd__(Intercept) 9.356829 NA NA NA NA ran_pars Residual sd__Observation 6.797395 NA NA NA NA "],["genomic-data.html", "4 Genomic data 4.1 Read duplicates 4.2 Depth of coverage 4.3 Breadth of coverage 4.4 Breadth vs. coverage", " 4 Genomic data 4.1 Read duplicates all_data %&gt;% select(dataset,Extraction,duplicates,Taxon) %&gt;% unique() %&gt;% group_by(Taxon,Extraction) %&gt;% summarise(value = sprintf(&quot;%.1f±%.1f&quot;, mean(duplicates), sd(duplicates))) %&gt;% pivot_wider(names_from = Extraction, values_from = value) %&gt;% tt(caption = &quot;Mean and standard deviation of fraction of duplicated reads&quot;) tinytable_8qfrsanq39own0cxbbpv .table td.tinytable_css_z52ata1c344q3ntvw1no, .table th.tinytable_css_z52ata1c344q3ntvw1no { border-bottom: solid 0.1em #d3d8dc; } Mean and standard deviation of fraction of duplicated reads Taxon ZYMO DREX EHEX Amphibian 0.3±0.2 0.2±0.2 0.2±0.2 Reptile 0.5±0.4 0.3±0.3 0.4±0.4 Mammal 0.4±0.4 0.2±0.1 0.2±0.2 Bird 0.8±0.3 0.9±0.1 0.6±0.4 Control 1.0±0.0 0.9±0.0 1.0±0.0 all_data %&gt;% select(dataset,Extraction,duplicates,Taxon, Species) %&gt;% mutate(duplicates=duplicates*100) %&gt;% unique() %&gt;% ggplot(aes(x=Extraction,y=duplicates, color=Species, group=Extraction)) + scale_y_reverse() + geom_boxplot(outlier.shape = NA, fill=&quot;#f4f4f4&quot;, color=&quot;#8c8c8c&quot;) + geom_jitter() + scale_color_manual(values=vertebrate_colors) + facet_grid(. ~ Taxon, scales = &quot;free&quot;) + theme_minimal() + labs(y=&quot;Duplication rate (%)&quot;,x=&quot;Extraction method&quot;) all_data %&gt;% select(dataset,Sample,Species,Extraction,duplicates,Taxon) %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% lmerTest::lmer(duplicates ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_il02xm1hwlqvsesjys67 .table td.tinytable_css_ib2r6mdxgg2vre1umbvt, .table th.tinytable_css_ib2r6mdxgg2vre1umbvt { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 0.48640693 0.07257915 6.701744 14.33359 8.937456e-06 fixed NA ExtractionDREX -0.09279626 0.03900562 -2.379048 160.72377 1.853073e-02 fixed NA ExtractionEHEX -0.14618630 0.03918499 -3.730671 160.73104 2.644423e-04 ran_pars Sample sd__(Intercept) 0.00000000 NA NA NA NA ran_pars Species sd__(Intercept) 0.23148121 NA NA NA NA ran_pars Residual sd__Observation 0.21005171 NA NA NA NA 4.2 Depth of coverage all_data %&gt;% select(dataset,Extraction,coverage_depth,Taxon) %&gt;% unique() %&gt;% group_by(Taxon,Extraction) %&gt;% summarise(value = sprintf(&quot;%.1f±%.1f&quot;, mean(coverage_depth), sd(coverage_depth))) %&gt;% pivot_wider(names_from = Extraction, values_from = value) %&gt;% tt(caption = &quot;Mean and standard deviation of fraction of duplicated reads&quot;) tinytable_ot5v9f6wejam5rf4b4ik .table td.tinytable_css_hgqagwc8isc6dcj3of9b, .table th.tinytable_css_hgqagwc8isc6dcj3of9b { border-bottom: solid 0.1em #d3d8dc; } Mean and standard deviation of fraction of duplicated reads Taxon ZYMO DREX EHEX Amphibian 0.0±0.0 0.0±0.0 0.0±0.0 Reptile 0.2±0.3 0.1±0.1 0.1±0.1 Mammal 0.7±1.2 0.3±0.4 0.5±1.0 Bird 0.4±0.8 0.6±0.5 0.8±0.8 Control 0.0±0.0 0.0±0.0 0.0±0.0 all_data %&gt;% select(dataset,Extraction,coverage_depth,Taxon, Species) %&gt;% unique() %&gt;% ggplot(aes(x=Extraction,y=coverage_depth, color=Species, group=Extraction)) + geom_boxplot(outlier.shape = NA, fill=&quot;#f4f4f4&quot;, color=&quot;#8c8c8c&quot;) + geom_jitter() + scale_color_manual(values=vertebrate_colors) + facet_grid(. ~ Taxon, scales = &quot;free&quot;) + theme_minimal() + labs(y=&quot;Depth of coverage&quot;,x=&quot;Extraction method&quot;) all_data %&gt;% select(dataset,Sample,Species,Extraction,coverage_depth,Taxon) %&gt;% unique() %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% lmerTest::lmer(coverage_depth ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_klelp5tidrp8zjzm7ksh .table td.tinytable_css_67mnc8uktjmrkh5ep7gf, .table th.tinytable_css_67mnc8uktjmrkh5ep7gf { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 0.329125000 0.1331063 2.47264850 20.58494 0.02222872 fixed NA ExtractionDREX -0.089791667 0.1144640 -0.78445305 48.00000 0.43662873 fixed NA ExtractionEHEX -0.002791667 0.1144640 -0.02438903 48.00000 0.98064341 ran_pars Sample sd__(Intercept) 0.408634577 NA NA NA NA ran_pars Species sd__(Intercept) 0.224731208 NA NA NA NA ran_pars Residual sd__Observation 0.396515070 NA NA NA NA 4.3 Breadth of coverage all_data %&gt;% select(dataset,Extraction,coverage_breadth,Taxon) %&gt;% unique() %&gt;% group_by(Taxon,Extraction) %&gt;% summarise(value = sprintf(&quot;%.1f±%.1f&quot;, mean(coverage_breadth), sd(coverage_breadth))) %&gt;% pivot_wider(names_from = Extraction, values_from = value) %&gt;% tt(caption = &quot;Mean and standard deviation of depth of host genome coverage&quot;) tinytable_869by62zm9jrbdl8ox9n .table td.tinytable_css_mfqv2u8gjdpiskqegpjp, .table th.tinytable_css_mfqv2u8gjdpiskqegpjp { border-bottom: solid 0.1em #d3d8dc; } Mean and standard deviation of depth of host genome coverage Taxon ZYMO DREX EHEX Amphibian 0.0±0.0 0.0±0.0 0.0±0.0 Reptile 4.9±7.5 3.0±5.4 2.9±3.7 Mammal 5.7±5.9 10.2±16.4 15.1±26.4 Bird 0.6±0.5 3.2±4.4 8.9±13.9 Control 0.0±0.0 0.0±0.0 0.0±0.0 all_data %&gt;% select(dataset,Extraction,coverage_breadth,Taxon,Species) %&gt;% unique() %&gt;% ggplot(aes(x=Extraction,y=coverage_breadth, color=Species, group=Extraction)) + geom_boxplot(outlier.shape = NA, fill=&quot;#f4f4f4&quot;, color=&quot;#8c8c8c&quot;) + geom_jitter() + scale_color_manual(values=vertebrate_colors) + facet_grid(. ~ Taxon, scales = &quot;free&quot;) + theme_minimal() + labs(y=&quot;Breadth of coverage (%)&quot;,x=&quot;Extraction method&quot;) all_data %&gt;% select(dataset,Extraction,Sample,Species,coverage_breadth,Taxon) %&gt;% unique() %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% lmerTest::lmer(coverage_breadth ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_3yllnc0yqjzr5rw9y0wq .table td.tinytable_css_zukdo41rpbztfs9gnzc7, .table th.tinytable_css_zukdo41rpbztfs9gnzc7 { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 2.799167 2.252826 1.2425133 20.82558 0.22785670 fixed NA ExtractionDREX 1.301250 1.956426 0.6651158 48.00000 0.50915975 fixed NA ExtractionEHEX 3.918750 1.956426 2.0030144 48.00000 0.05084021 ran_pars Sample sd__(Intercept) 7.118462 NA NA NA NA ran_pars Species sd__(Intercept) 3.549767 NA NA NA NA ran_pars Residual sd__Observation 6.777259 NA NA NA NA 4.4 Breadth vs. coverage all_data_log &lt;- all_data %&gt;% mutate(coverage_breadth_log=log(coverage_breadth)) %&gt;% mutate(coverage_depth_log=log(coverage_depth)) lm_eq &lt;- lm(coverage_breadth_log ~ coverage_depth_log, data = all_data_log %&gt;% filter(coverage_depth_log != -Inf ,coverage_breadth_log != -Inf)) coef &lt;- coef(lm_eq) all_data_log$coverage_breadth_log_pred &lt;- coef[1] + coef[2] * all_data_log$coverage_depth_log all_data_log %&gt;% select(dataset,Extraction,coverage_depth_log,coverage_breadth_log,coverage_breadth_log_pred,Taxon,Species,Sample) %&gt;% unique() %&gt;% ggplot(aes(x=coverage_depth_log,y=coverage_breadth_log)) + geom_point(aes(color=Species, shape=Extraction),size=3, alpha=0.9) + geom_segment(aes(x = coverage_depth_log, y = coverage_breadth_log, xend = coverage_depth_log, yend = coverage_breadth_log_pred, color=Species), alpha=0.9)+ geom_smooth(method = lm, se = FALSE, color=&quot;#666666&quot;) + scale_color_manual(values=vertebrate_colors) + theme_minimal() + labs(y=&quot;Breadth of coverage (%)&quot;,x=&quot;Depth of coverage&quot;) "],["metagenomic-data.html", "5 Metagenomic data 5.1 Library complexity 5.2 Alpha diversity 5.3 Microbial complexity recovery 5.4 Variance partitioning 5.5 Combined community analysis", " 5 Metagenomic data Species-specific community analyses conducted to generate the data included in these analyses can be found in the annex. Amphibians Calotriton asper Lissotriton helveticus Salamandra atra Birds Geospizopsis unicolor Perisoreus infaustus Zonotrichia capensis Mammals Plecotus auritus Sciurus carolinensis Trichosurus vulpecula Reptiles Chalcides striatus Natrix astreptophora Podarcis muralis 5.1 Library complexity Nonpareil estimate of the metagenomic complexity after removing host DNA. all_data %&gt;% select(dataset,Extraction,nonpareil,Taxon) %&gt;% unique() %&gt;% group_by(Taxon,Extraction) %&gt;% summarise(value = sprintf(&quot;%.1f±%.1f&quot;, mean(nonpareil), sd(nonpareil))) %&gt;% pivot_wider(names_from = Extraction, values_from = value) %&gt;% tt(caption = &quot;Mean and standard deviation of breadth of host genome coverage&quot;) tinytable_2m5n4d93losb96o0p1gr .table td.tinytable_css_be1qmpez7zbl570pun90, .table th.tinytable_css_be1qmpez7zbl570pun90 { border-bottom: solid 0.1em #d3d8dc; } Mean and standard deviation of breadth of host genome coverage Taxon ZYMO DREX EHEX Amphibian 0.9±0.1 0.8±0.1 0.8±0.1 Reptile 0.9±0.1 0.9±0.0 0.9±0.1 Mammal 0.8±0.2 0.8±0.1 0.7±0.3 Bird 0.9±0.1 1.0±0.0 0.8±0.4 Control 0.0±0.0 0.5±0.6 0.5±0.7 all_data %&gt;% select(dataset,Extraction,nonpareil,Taxon,Species) %&gt;% unique() %&gt;% ggplot(aes(x=Extraction,y=nonpareil, color=Species, group=Extraction)) + geom_boxplot(outlier.shape = NA, fill=&quot;#f4f4f4&quot;, color=&quot;#8c8c8c&quot;) + geom_jitter() + scale_color_manual(values=vertebrate_colors) + facet_grid(. ~ Taxon, scales = &quot;free&quot;) + theme_minimal() + labs(y=&quot;Nonpareil completeness&quot;,x=&quot;Extraction method&quot;) all_data %&gt;% select(dataset,Extraction,Sample,Species,nonpareil,Taxon) %&gt;% unique() %&gt;% mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% lmerTest::lmer(nonpareil ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_2wmcf9wtktrld99xj166 .table td.tinytable_css_tanzgt8dj7j15cp8dl4g, .table th.tinytable_css_tanzgt8dj7j15cp8dl4g { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 0.885552853 0.03450229 25.6664948 40.89542 7.753071e-27 fixed NA ExtractionDREX 0.005536892 0.04336611 0.1276779 48.00020 8.989373e-01 fixed NA ExtractionEHEX -0.112193866 0.04336611 -2.5871326 48.00020 1.276294e-02 ran_pars Sample sd__(Intercept) 0.059565487 NA NA NA NA ran_pars Species sd__(Intercept) 0.035030813 NA NA NA NA ran_pars Residual sd__Observation 0.150224598 NA NA NA NA 5.2 Alpha diversity Variance partitioning metrics are derived from community_analysis.Rmd. alpha_data &lt;- list.files(path = &quot;results&quot;, pattern = &quot;^alpha_.*\\\\.tsv$&quot;, full.names = TRUE) %&gt;% map_df(~ read_tsv(.)) %&gt;% left_join(all_data,by= join_by(dataset==dataset)) alpha_data %&gt;% pivot_longer(!c(dataset,Library,Species,Taxon,Sample,Extraction), names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% filter(metric %in% c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;)) %&gt;% mutate(metric=factor(metric,levels=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;))) %&gt;% mutate(Taxon=factor(Taxon,levels=c(&quot;Amphibian&quot;,&quot;Reptile&quot;,&quot;Mammal&quot;))) %&gt;% mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% unique() %&gt;% ggplot(aes(x=Extraction,y=value, color=Species, group=Extraction)) + geom_boxplot(outlier.shape = NA, fill=&quot;#f4f4f4&quot;, color=&quot;#8c8c8c&quot;) + geom_jitter() + scale_color_manual(values=vertebrate_colors) + facet_grid(metric ~ Taxon, scales = &quot;free&quot;) + theme_minimal() + labs(y=&quot;Diversity&quot;,x=&quot;Extraction method&quot;) 5.2.1 Richness alpha_data %&gt;% select(dataset,Extraction,Sample,Species,richness,Taxon) %&gt;% unique() %&gt;% mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% lmerTest::lmer(richness ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_py6z5vve7fbiw0vach7n .table td.tinytable_css_dhi3exosrepuhb4t2yre, .table th.tinytable_css_dhi3exosrepuhb4t2yre { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 59.44444444 10.715517 5.5475108 10.12322 0.000234351 fixed NA ExtractionDREX 0.05555556 4.453352 0.0124750 34.97883 0.990117532 fixed NA ExtractionEHEX 1.38257472 4.545332 0.3041746 35.13134 0.762789322 ran_pars Sample sd__(Intercept) 16.00359332 NA NA NA NA ran_pars Species sd__(Intercept) 28.56742258 NA NA NA NA ran_pars Residual sd__Observation 13.36005511 NA NA NA NA 5.2.2 Neutral alpha_data %&gt;% select(dataset,Extraction,Sample,Species,neutral,Taxon) %&gt;% unique() %&gt;% mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% lmerTest::lmer(neutral ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_6gl41z783qrooh4nh5nl .table td.tinytable_css_nam2p4h6qt3amz8jzhlt, .table th.tinytable_css_nam2p4h6qt3amz8jzhlt { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 29.5413181 5.139162 5.7482754 9.895197 0.000193227 fixed NA ExtractionDREX -2.1102758 1.922343 -1.0977625 35.042971 0.279794105 fixed NA ExtractionEHEX -0.3422373 1.962694 -0.1743712 35.152526 0.862574163 ran_pars Sample sd__(Intercept) 8.6429526 NA NA NA NA ran_pars Species sd__(Intercept) 13.5543072 NA NA NA NA ran_pars Residual sd__Observation 5.7670282 NA NA NA NA 5.2.3 Phylogenetic alpha_data %&gt;% select(dataset,Extraction,Sample,Species,phylogenetic,Taxon) %&gt;% unique() %&gt;% mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% lmerTest::lmer(phylogenetic ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_5qyggmfw01l8a0jiux9t .table td.tinytable_css_awo61h2me0gkvqoo6uiq, .table th.tinytable_css_awo61h2me0gkvqoo6uiq { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 4.7721984 0.4324985 11.034024 9.653749 8.685117e-07 fixed NA ExtractionDREX 0.1521100 0.1403528 1.083769 35.015284 2.858737e-01 fixed NA ExtractionEHEX 0.1852709 0.1433723 1.292236 35.056809 2.047290e-01 ran_pars Sample sd__(Intercept) 1.2179889 NA NA NA NA ran_pars Species sd__(Intercept) 0.9236345 NA NA NA NA ran_pars Residual sd__Observation 0.4210584 NA NA NA NA 5.3 Microbial complexity recovery all_data %&gt;% select(dataset,Extraction,microbial_fraction,MAG_mapping_percentage,Taxon) %&gt;% mutate(damr=pmin(1,MAG_mapping_percentage/(microbial_fraction*100))) %&gt;% mutate(damr=ifelse(is.na(damr),0,damr)) %&gt;% unique() %&gt;% group_by(Taxon,Extraction) %&gt;% summarise(value = sprintf(&quot;%.1f±%.1f&quot;, mean(damr), sd(damr))) %&gt;% pivot_wider(names_from = Extraction, values_from = value) %&gt;% tt(caption = &quot;Mean and standard deviation of breadth of host genome coverage&quot;) tinytable_k090lb1qlzyjotn7bf0c .table td.tinytable_css_stzxvo5hdrv8wsmod9nb, .table th.tinytable_css_stzxvo5hdrv8wsmod9nb { border-bottom: solid 0.1em #d3d8dc; } Mean and standard deviation of breadth of host genome coverage Taxon ZYMO DREX EHEX Amphibian 0.8±0.4 0.8±0.3 0.8±0.3 Reptile 0.9±0.1 1.0±0.0 1.0±0.0 Mammal 0.8±0.1 0.9±0.1 0.8±0.3 Bird 0.6±0.4 0.5±0.4 0.6±0.4 Control 1.0±0.0 1.0±0.0 1.0±0.0 all_data %&gt;% select(dataset,Extraction,microbial_fraction,MAG_mapping_percentage,Taxon,Sample,Species) %&gt;% mutate(damr=pmin(1,MAG_mapping_percentage/(microbial_fraction*100))) %&gt;% mutate(damr=ifelse(is.na(damr),0,damr)) %&gt;% unique() %&gt;% ggplot(aes(x=Extraction,y=damr, color=Species, group=Extraction)) + geom_boxplot(outlier.shape = NA, fill=&quot;#f4f4f4&quot;, color=&quot;#8c8c8c&quot;) + geom_jitter() + scale_color_manual(values=vertebrate_colors) + facet_grid(. ~ Taxon, scales = &quot;free&quot;) + theme_minimal() + labs(y=&quot;Domain-adjusted mapping rate&quot;,x=&quot;Extraction method&quot;) all_data %&gt;% select(dataset,Extraction,microbial_fraction,MAG_mapping_percentage,Taxon, Sample, Species) %&gt;% mutate(damr=pmin(1,MAG_mapping_percentage/(microbial_fraction*100))) %&gt;% mutate(damr=ifelse(is.na(damr),0,damr)) %&gt;% unique() %&gt;% mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% lmerTest::lmer(damr ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_qv8j3nsrxbbr9dmkbuof .table td.tinytable_css_do48gqtz78s2gbn3ihbu, .table th.tinytable_css_do48gqtz78s2gbn3ihbu { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 0.78271978 0.06660971 11.7508366 15.45687 4.117675e-09 fixed NA ExtractionDREX 0.03348421 0.03977983 0.8417385 130.19072 4.014779e-01 fixed NA ExtractionEHEX 0.02228400 0.03999367 0.5571881 130.24817 5.783552e-01 ran_pars Sample sd__(Intercept) 0.12024342 NA NA NA NA ran_pars Species sd__(Intercept) 0.19047224 NA NA NA NA ran_pars Residual sd__Observation 0.20283813 NA NA NA NA 5.4 Variance partitioning Variance partitioning metrics are derived from community_analysis.Rmd. variance_data &lt;- list.files(path = &quot;results&quot;, pattern = &quot;^var_.*\\\\.tsv$&quot;, full.names = TRUE) %&gt;% map_df(~ read_tsv(.)) variance_data %&gt;% summarise(mean=mean(r2),sd=sd(r2)) # A tibble: 1 × 2 mean sd &lt;dbl&gt; &lt;dbl&gt; 1 0.102 0.0768 variance_data %&gt;% left_join(all_data %&gt;% select(Species,Taxon) %&gt;% unique(),by=join_by(species==Species)) %&gt;% mutate(metric=factor(metric,levels=c(&quot;phylogenetic&quot;,&quot;neutral&quot;,&quot;richness&quot;))) %&gt;% mutate(Taxon=factor(Taxon,levels=c(&quot;Amphibian&quot;,&quot;Reptile&quot;,&quot;Mammal&quot;))) %&gt;% ggplot(aes(x=r2,y=metric)) + geom_boxplot(outlier.shape = NA, fill=&quot;#f4f4f4&quot;, color=&quot;#8c8c8c&quot;) + geom_jitter(aes(color=species))+ scale_color_manual(values=vertebrate_colors) + xlim(0,0.5)+ theme_minimal() + labs(y=&quot;Diversity metric&quot;,x=&quot;Explained variance&quot;) variance_data %&gt;% group_by(metric) %&gt;% summarise(mean=mean(r2),sd=sd(r2)) %&gt;% tt() tinytable_lpk23f4vomsoe1wrux2g .table td.tinytable_css_cm1iv16btdigtwa2dyj4, .table th.tinytable_css_cm1iv16btdigtwa2dyj4 { border-bottom: solid 0.1em #d3d8dc; } metric mean sd neutral 0.06201935 0.04744380 phylogenetic 0.07381277 0.06884687 richness 0.16970818 0.06626388 5.5 Combined community analysis species=&quot;combined&quot; genus=species sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0134/DMB0134_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0134/DMB0134_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0134/DMB0134_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0134/DMB0134.tree.gz&quot;, &quot;data/DMB0134.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0134.tree.gz&quot;) 5.5.1 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 5.5.2 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% mutate(Taxon=factor(Taxon,levels=c(&quot;Amphibian&quot;, &quot;Reptile&quot;, &quot;Mammal&quot;, &quot;Bird&quot;, &quot;Control&quot;))) %&gt;% mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;, &quot;DREX&quot;, &quot;EHEX&quot;))) %&gt;% mutate(Species=factor(Species,levels=c(&quot;Calotriton asper&quot;, &quot;Lissotriton helveticus&quot;, &quot;Salamandra atra&quot;, &quot;Chalcides striatus&quot;, &quot;Natrix astreptophora&quot;, &quot;Podarcis muralis&quot;, &quot;Plecotus auritus&quot;, &quot;Sciurus carolinensis&quot;, &quot;Trichosurus vulpecula&quot;, &quot;Geospizopsis unicolor&quot;, &quot;Perisoreus infaustus&quot;, &quot;Zonotrichia capensis&quot;, &quot;Extraction control&quot;, &quot;Library control&quot;))) %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Taxon + Species + Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.title=element_blank(), panel.spacing = unit(0, &quot;lines&quot;)) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) genome_counts_NMDS &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;, out=&quot;dist&quot;) %&gt;% metaMDS(.,trymax = 999, k=2, trace=0) %&gt;% vegan::scores() %&gt;% as_tibble(., rownames = &quot;dataset&quot;) %&gt;% left_join(sample_metadata, by = join_by(dataset == dataset)) %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% group_by(Sample) %&gt;% mutate(sample_x=mean(NMDS1), sample_y=mean(NMDS2)) genome_counts_NMDS %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=Species, shape=Extraction)) + scale_color_manual(values=vertebrate_colors) + geom_point(size=3, alpha=0.8) + geom_segment(aes(x=sample_x, y=sample_y, xend=NMDS1, yend=NMDS2), alpha=0.2) + theme_classic() + theme(legend.position=&quot;right&quot;, legend.box=&quot;vertical&quot;) + guides(color=guide_legend(title=&quot;Species&quot;)) "],["amphibians.html", "6 Amphibians 6.1 Calotriton asper 6.2 Lissotriton helveticus 6.3 Salamandra atra", " 6 Amphibians 6.1 Calotriton asper 6.1.1 Retrieve data species=&quot;Calotriton asper&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0121/DMB0121_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0121/DMB0121_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0121/DMB0121_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0121/DMB0121.tree.gz&quot;, &quot;data/DMB0121.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0121.tree.gz&quot;) 6.1.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 6.1.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 6.1.4 Alpha diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=0) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(richness=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(neutral=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1,tree=genome_tree) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(phylogenetic=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) # Merge alpha diversities alpha_diversity &lt;- richness %&gt;% full_join(neutral,by=join_by(dataset==dataset)) %&gt;% full_join(phylogenetic,by=join_by(dataset==dataset)) # Write alpha diversities alpha_diversity %&gt;% write_tsv(paste0(&quot;results/alpha_&quot;,genus,&quot;.tsv&quot;)) # Print alpha diversity alpha_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(dataset==dataset)) %&gt;% group_by(Extraction) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_ljn7jv7lurwnjzpg0a6t .table td.tinytable_css_wva2h008oskb1krptwuk, .table th.tinytable_css_wva2h008oskb1krptwuk { border-bottom: solid 0.1em #d3d8dc; } Extraction richness neutral phylogenetic DREX 107.0 51.75880 6.406283 EHEX 106.5 51.56757 6.311931 ZYMO 97.5 48.75158 6.219160 6.1.5 Beta diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;, out=&quot;pair&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;, out=&quot;pair&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;, out=&quot;pair&quot;) # Merge beta diversities beta_diversity &lt;- richness %&gt;% full_join(neutral,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% full_join(phylogenetic,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% rename(richness=C.x, neutral=C.y, phylogenetic=C) # Write beta diversities beta_diversity %&gt;% write_tsv(paste0(&quot;results/beta_&quot;,genus,&quot;.tsv&quot;)) # Print beta diversities beta_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(first==dataset)) %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(second==dataset)) %&gt;% mutate(relationship = case_when( Extraction.x == Extraction.y &amp; Sample.x != Sample.y ~ &quot;inter&quot;, Extraction.x != Extraction.y &amp; Sample.x == Sample.y ~ &quot;intra&quot;, TRUE ~ NA_character_ # Handle other cases if needed )) %&gt;% filter(relationship != is.na(relationship)) %&gt;% group_by(relationship) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_0miwuwkvryvufckdb26q .table td.tinytable_css_6wn07srlvlarxx8jkux6, .table th.tinytable_css_6wn07srlvlarxx8jkux6 { border-bottom: solid 0.1em #d3d8dc; } relationship richness neutral phylogenetic inter 0.29497046 0.381599435 0.105560612 intra 0.03215577 0.007477988 0.001740429 6.1.6 Variance partitioning richness &lt;-genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() tibble(species=rep(species,3),metric=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;),r2=c(richness,neutral,phylogenetic)) %&gt;% write_tsv(paste0(&quot;results/var_&quot;,genus,&quot;.tsv&quot;)) 6.2 Lissotriton helveticus 6.2.1 Retrieve data species=&quot;Lissotriton helveticus&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0124/DMB0124_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0124/DMB0124_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0124/DMB0124_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0124/DMB0124.tree.gz&quot;, &quot;data/DMB0124.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0124.tree.gz&quot;) 6.2.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 6.2.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 6.2.4 Alpha diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=0) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(richness=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(neutral=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1,tree=genome_tree) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(phylogenetic=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) # Merge alpha diversities alpha_diversity &lt;- richness %&gt;% full_join(neutral,by=join_by(dataset==dataset)) %&gt;% full_join(phylogenetic,by=join_by(dataset==dataset)) # Write alpha diversities alpha_diversity %&gt;% write_tsv(paste0(&quot;results/alpha_&quot;,genus,&quot;.tsv&quot;)) # Print alpha diversity alpha_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(dataset==dataset)) %&gt;% group_by(Extraction) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_zqoxc2fajobra7r0x637 .table td.tinytable_css_mbwl4swul5h0tnbmqr16, .table th.tinytable_css_mbwl4swul5h0tnbmqr16 { border-bottom: solid 0.1em #d3d8dc; } Extraction richness neutral phylogenetic DREX 22 12.05083 4.439034 EHEX 22 12.15999 4.408855 ZYMO 21 10.73360 3.336904 6.2.5 Beta diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;, out=&quot;pair&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;, out=&quot;pair&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;, out=&quot;pair&quot;) # Merge beta diversities beta_diversity &lt;- richness %&gt;% full_join(neutral,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% full_join(phylogenetic,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% rename(richness=C.x, neutral=C.y, phylogenetic=C) # Write beta diversities beta_diversity %&gt;% write_tsv(paste0(&quot;results/beta_&quot;,genus,&quot;.tsv&quot;)) # Print beta diversities beta_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(first==dataset)) %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(second==dataset)) %&gt;% mutate(relationship = case_when( Extraction.x == Extraction.y &amp; Sample.x != Sample.y ~ &quot;inter&quot;, Extraction.x != Extraction.y &amp; Sample.x == Sample.y ~ &quot;intra&quot;, TRUE ~ NA_character_ # Handle other cases if needed )) %&gt;% filter(relationship != is.na(relationship)) %&gt;% group_by(relationship) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_7vx8tbhv96r69n2o0wba .table td.tinytable_css_m6skkdi5hf7a44m6yn6q, .table th.tinytable_css_m6skkdi5hf7a44m6yn6q { border-bottom: solid 0.1em #d3d8dc; } relationship richness neutral phylogenetic inter 0.9090909 0.9487207 0.3681096 intra 0.2288066 0.1798833 0.1289869 6.2.6 Variance partitioning richness &lt;-genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() tibble(species=rep(species,3),metric=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;),r2=c(richness,neutral,phylogenetic)) %&gt;% write_tsv(paste0(&quot;results/var_&quot;,genus,&quot;.tsv&quot;)) 6.3 Salamandra atra 6.3.1 Retrieve data species=&quot;Salamandra atra&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0129/DMB0129_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0129/DMB0129_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0129/DMB0129_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0129/DMB0129.tree.gz&quot;, &quot;data/DMB0129.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0129.tree.gz&quot;) 6.3.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 6.3.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 6.3.4 Alpha diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=0) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(richness=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(neutral=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1,tree=genome_tree) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(phylogenetic=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) # Merge alpha diversities alpha_diversity &lt;- richness %&gt;% full_join(neutral,by=join_by(dataset==dataset)) %&gt;% full_join(phylogenetic,by=join_by(dataset==dataset)) # Write alpha diversities alpha_diversity %&gt;% write_tsv(paste0(&quot;results/alpha_&quot;,genus,&quot;.tsv&quot;)) # Print alpha diversity alpha_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(dataset==dataset)) %&gt;% group_by(Extraction) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_ac21cnrqo27eoy0c4ys4 .table td.tinytable_css_riwow2kbr52gbos7gzhu, .table th.tinytable_css_riwow2kbr52gbos7gzhu { border-bottom: solid 0.1em #d3d8dc; } Extraction richness neutral phylogenetic DREX 70.0 35.33416 6.024485 EHEX 84.0 38.29817 6.183859 ZYMO 58.5 30.15278 5.653610 6.3.5 Beta diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;, out=&quot;pair&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;, out=&quot;pair&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;, out=&quot;pair&quot;) # Merge beta diversities beta_diversity &lt;- richness %&gt;% full_join(neutral,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% full_join(phylogenetic,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% rename(richness=C.x, neutral=C.y, phylogenetic=C) # Write beta diversities beta_diversity %&gt;% write_tsv(paste0(&quot;results/beta_&quot;,genus,&quot;.tsv&quot;)) # Print beta diversities beta_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(first==dataset)) %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(second==dataset)) %&gt;% mutate(relationship = case_when( Extraction.x == Extraction.y &amp; Sample.x != Sample.y ~ &quot;inter&quot;, Extraction.x != Extraction.y &amp; Sample.x == Sample.y ~ &quot;intra&quot;, TRUE ~ NA_character_ # Handle other cases if needed )) %&gt;% filter(relationship != is.na(relationship)) %&gt;% group_by(relationship) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_xm481ztessd4z8ktj2to .table td.tinytable_css_rq78g5epfp8tvg6r1ww1, .table th.tinytable_css_rq78g5epfp8tvg6r1ww1 { border-bottom: solid 0.1em #d3d8dc; } relationship richness neutral phylogenetic inter 0.3854701 0.3862921 0.125862853 intra 0.1422510 0.0315443 0.007370115 6.3.6 Variance partitioning richness &lt;-genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() tibble(species=rep(species,3),metric=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;),r2=c(richness,neutral,phylogenetic)) %&gt;% write_tsv(paste0(&quot;results/var_&quot;,genus,&quot;.tsv&quot;)) "],["birds.html", "7 Birds 7.1 Geospizopsis unicolor 7.2 Perisoreus infaustus 7.3 Zonotrichia capensis", " 7 Birds 7.1 Geospizopsis unicolor 7.1.1 Retrieve data species=&quot;Geospizopsis unicolor&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0123/DMB0123_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0123/DMB0123_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0123/DMB0123_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0123/DMB0123.tree.gz&quot;, &quot;data/DMB0123.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0123.tree.gz&quot;) 7.1.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 7.1.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 7.1.4 Alpha diversity Alpha diversity is not calculated as only one sample contains enough genome coverage to calculate diversity estimates. 7.1.5 Beta diversity Beta diversity is not calculated as only one sample contains enough genome coverage to calculate diversity estimates. 7.2 Perisoreus infaustus 7.2.1 Retrieve data species=&quot;Perisoreus infaustus&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0126/DMB0126_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0126/DMB0126_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0126/DMB0126_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0126/DMB0126.tree.gz&quot;, &quot;data/DMB0126.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0126.tree.gz&quot;) 7.2.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 7.2.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 7.2.4 Alpha diversity Alpha diversity is not calculated as only one sample contains enough genome coverage to calculate diversity estimates. 7.2.5 Beta diversity Beta diversity is not calculated as only one sample contains enough genome coverage to calculate diversity estimates. 7.3 Zonotrichia capensis The number of reconstructed genomes was too low for community analyses. "],["mammals.html", "8 Mammals 8.1 Plecotus auritus 8.2 Sciurus carolinensis 8.3 Trichosurus vulpecula", " 8 Mammals 8.1 Plecotus auritus 8.1.1 Retrieve data species=&quot;Plecotus auritus&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0127/DMB0127_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0127/DMB0127_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0127/DMB0127_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0127/DMB0127.tree.gz&quot;, &quot;data/DMB0127.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0127.tree.gz&quot;) 8.1.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 8.1.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 8.1.4 Alpha diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=0) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(richness=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(neutral=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1,tree=genome_tree) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(phylogenetic=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) # Merge alpha diversities alpha_diversity &lt;- richness %&gt;% full_join(neutral,by=join_by(dataset==dataset)) %&gt;% full_join(phylogenetic,by=join_by(dataset==dataset)) # Write alpha diversities alpha_diversity %&gt;% write_tsv(paste0(&quot;results/alpha_&quot;,genus,&quot;.tsv&quot;)) # Print alpha diversity alpha_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(dataset==dataset)) %&gt;% group_by(Extraction) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_r9whrgr6yrz9amgc1gz3 .table td.tinytable_css_7jffkrhit1013zp6yjz3, .table th.tinytable_css_7jffkrhit1013zp6yjz3 { border-bottom: solid 0.1em #d3d8dc; } Extraction richness neutral phylogenetic DREX 12.5 5.070885 2.691939 EHEX 11.5 5.348040 2.739107 ZYMO 6.5 4.042292 2.282549 8.1.5 Beta diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;, out=&quot;pair&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;, out=&quot;pair&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;, out=&quot;pair&quot;) # Merge beta diversities beta_diversity &lt;- richness %&gt;% full_join(neutral,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% full_join(phylogenetic,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% rename(richness=C.x, neutral=C.y, phylogenetic=C) # Write beta diversities beta_diversity %&gt;% write_tsv(paste0(&quot;results/beta_&quot;,genus,&quot;.tsv&quot;)) # Print beta diversities beta_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(first==dataset)) %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(second==dataset)) %&gt;% mutate(relationship = case_when( Extraction.x == Extraction.y &amp; Sample.x != Sample.y ~ &quot;inter&quot;, Extraction.x != Extraction.y &amp; Sample.x == Sample.y ~ &quot;intra&quot;, TRUE ~ NA_character_ # Handle other cases if needed )) %&gt;% filter(relationship != is.na(relationship)) %&gt;% group_by(relationship) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_dt8h9yj4mklnrt3td10q .table td.tinytable_css_ap8iv84mcrfatescnsbe, .table th.tinytable_css_ap8iv84mcrfatescnsbe { border-bottom: solid 0.1em #d3d8dc; } relationship richness neutral phylogenetic inter 0.6727759 0.82731396 0.68954392 intra 0.2123748 0.03113448 0.01336019 8.1.6 Variance partitioning richness &lt;-genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() tibble(species=rep(species,3),metric=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;),r2=c(richness,neutral,phylogenetic)) %&gt;% write_tsv(paste0(&quot;results/var_&quot;,genus,&quot;.tsv&quot;)) 8.2 Sciurus carolinensis 8.2.1 Retrieve data species=&quot;Sciurus carolinensis&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0130/DMB0130_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0130/DMB0130_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0130/DMB0130_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0130/DMB0130.tree.gz&quot;, &quot;data/DMB0130.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0130.tree.gz&quot;) 8.2.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 8.2.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 8.2.4 Alpha diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=0) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(richness=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(neutral=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1,tree=genome_tree) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(phylogenetic=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) # Merge alpha diversities alpha_diversity &lt;- richness %&gt;% full_join(neutral,by=join_by(dataset==dataset)) %&gt;% full_join(phylogenetic,by=join_by(dataset==dataset)) # Write alpha diversities alpha_diversity %&gt;% write_tsv(paste0(&quot;results/alpha_&quot;,genus,&quot;.tsv&quot;)) # Print alpha diversity alpha_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(dataset==dataset)) %&gt;% group_by(Extraction) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_4lwmjg3wbodfm2b9b5tv .table td.tinytable_css_cuj2ajnn9e7dj387i7gv, .table th.tinytable_css_cuj2ajnn9e7dj387i7gv { border-bottom: solid 0.1em #d3d8dc; } Extraction richness neutral phylogenetic DREX 95.0 39.66320 5.557244 EHEX 96.0 47.74310 5.728024 ZYMO 107.5 59.13437 6.138243 8.2.5 Beta diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;, out=&quot;pair&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;, out=&quot;pair&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;, out=&quot;pair&quot;) # Merge beta diversities beta_diversity &lt;- richness %&gt;% full_join(neutral,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% full_join(phylogenetic,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% rename(richness=C.x, neutral=C.y, phylogenetic=C) # Write beta diversities beta_diversity %&gt;% write_tsv(paste0(&quot;results/beta_&quot;,genus,&quot;.tsv&quot;)) # Print beta diversities beta_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(first==dataset)) %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(second==dataset)) %&gt;% mutate(relationship = case_when( Extraction.x == Extraction.y &amp; Sample.x != Sample.y ~ &quot;inter&quot;, Extraction.x != Extraction.y &amp; Sample.x == Sample.y ~ &quot;intra&quot;, TRUE ~ NA_character_ # Handle other cases if needed )) %&gt;% filter(relationship != is.na(relationship)) %&gt;% group_by(relationship) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_6txev2youebubp23vxwh .table td.tinytable_css_vtx1snvj9bim8wjrp4qt, .table th.tinytable_css_vtx1snvj9bim8wjrp4qt { border-bottom: solid 0.1em #d3d8dc; } relationship richness neutral phylogenetic inter 0.4447768 0.6554629 0.19033972 intra 0.1823044 0.1211974 0.03562178 8.2.6 Variance partitioning richness &lt;-genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() tibble(species=rep(species,3),metric=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;),r2=c(richness,neutral,phylogenetic)) %&gt;% write_tsv(paste0(&quot;results/var_&quot;,genus,&quot;.tsv&quot;)) 8.3 Trichosurus vulpecula 8.3.1 Retrieve data species=&quot;Trichosurus vulpecula&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0131/DMB0131_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0131/DMB0131_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0131/DMB0131_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0131/DMB0131.tree.gz&quot;, &quot;data/DMB0131.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0131.tree.gz&quot;) 8.3.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 8.3.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 8.3.4 Alpha diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=0) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(richness=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(neutral=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1,tree=genome_tree) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(phylogenetic=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) # Merge alpha diversities alpha_diversity &lt;- richness %&gt;% full_join(neutral,by=join_by(dataset==dataset)) %&gt;% full_join(phylogenetic,by=join_by(dataset==dataset)) # Write alpha diversities alpha_diversity %&gt;% write_tsv(paste0(&quot;results/alpha_&quot;,genus,&quot;.tsv&quot;)) # Print alpha diversity alpha_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(dataset==dataset)) %&gt;% group_by(Extraction) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_g0cebunaxhrcvngbwdf2 .table td.tinytable_css_p9xok2uaryboil0u1cj7, .table th.tinytable_css_p9xok2uaryboil0u1cj7 { border-bottom: solid 0.1em #d3d8dc; } Extraction richness neutral phylogenetic DREX 50.5 21.91494 5.924827 EHEX 72.0 28.43487 7.338228 ZYMO 67.5 28.14959 6.253726 8.3.5 Beta diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;, out=&quot;pair&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;, out=&quot;pair&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;, out=&quot;pair&quot;) # Merge beta diversities beta_diversity &lt;- richness %&gt;% full_join(neutral,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% full_join(phylogenetic,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% rename(richness=C.x, neutral=C.y, phylogenetic=C) # Write beta diversities beta_diversity %&gt;% write_tsv(paste0(&quot;results/beta_&quot;,genus,&quot;.tsv&quot;)) # Print beta diversities beta_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(first==dataset)) %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(second==dataset)) %&gt;% mutate(relationship = case_when( Extraction.x == Extraction.y &amp; Sample.x != Sample.y ~ &quot;inter&quot;, Extraction.x != Extraction.y &amp; Sample.x == Sample.y ~ &quot;intra&quot;, TRUE ~ NA_character_ # Handle other cases if needed )) %&gt;% filter(relationship != is.na(relationship)) %&gt;% group_by(relationship) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_ju7iyfwq2sk13tczh7gp .table td.tinytable_css_0rpo8k6nozpauhztnx9n, .table th.tinytable_css_0rpo8k6nozpauhztnx9n { border-bottom: solid 0.1em #d3d8dc; } relationship richness neutral phylogenetic inter 0.3673634 0.55492808 0.26261760 intra 0.1050321 0.02750575 0.01017398 8.3.6 Variance partitioning Variance partitioning was not conducted because EHI02106 failed to yield any data. "],["reptiles.html", "9 Reptiles 9.1 Chalcides striatus 9.2 Natrix astreptophora 9.3 Podarcis muralis", " 9 Reptiles 9.1 Chalcides striatus 9.1.1 Retrieve data species=&quot;Chalcides striatus&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0122/DMB0122_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0122/DMB0122_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0122/DMB0122_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0122/DMB0122.tree.gz&quot;, &quot;data/DMB0122.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0122.tree.gz&quot;) 9.1.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 9.1.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 9.1.4 Alpha diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=0) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(richness=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(neutral=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1,tree=genome_tree) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(phylogenetic=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) # Merge alpha diversities alpha_diversity &lt;- richness %&gt;% full_join(neutral,by=join_by(dataset==dataset)) %&gt;% full_join(phylogenetic,by=join_by(dataset==dataset)) # Write alpha diversities alpha_diversity %&gt;% write_tsv(paste0(&quot;results/alpha_&quot;,genus,&quot;.tsv&quot;)) # Print alpha diversity alpha_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(dataset==dataset)) %&gt;% group_by(Extraction) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_lcgg8gw7culp8p96l11v .table td.tinytable_css_mm54ll6c8v0y06r8me60, .table th.tinytable_css_mm54ll6c8v0y06r8me60 { border-bottom: solid 0.1em #d3d8dc; } Extraction richness neutral phylogenetic DREX 60.5 31.68716 5.314585 EHEX 64.5 34.15145 5.180680 ZYMO 74.0 37.04400 5.254353 9.1.5 Beta diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;, out=&quot;pair&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;, out=&quot;pair&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;, out=&quot;pair&quot;) # Merge beta diversities beta_diversity &lt;- richness %&gt;% full_join(neutral,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% full_join(phylogenetic,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% rename(richness=C.x, neutral=C.y, phylogenetic=C) # Write beta diversities beta_diversity %&gt;% write_tsv(paste0(&quot;results/beta_&quot;,genus,&quot;.tsv&quot;)) # Print beta diversities beta_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(first==dataset)) %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(second==dataset)) %&gt;% mutate(relationship = case_when( Extraction.x == Extraction.y &amp; Sample.x != Sample.y ~ &quot;inter&quot;, Extraction.x != Extraction.y &amp; Sample.x == Sample.y ~ &quot;intra&quot;, TRUE ~ NA_character_ # Handle other cases if needed )) %&gt;% filter(relationship != is.na(relationship)) %&gt;% group_by(relationship) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_shf7pcijp5l0oh4lk4vg .table td.tinytable_css_6gkwj13i2wvcspa0493v, .table th.tinytable_css_6gkwj13i2wvcspa0493v { border-bottom: solid 0.1em #d3d8dc; } relationship richness neutral phylogenetic inter 0.4109306 0.45373698 0.09334837 intra 0.1286148 0.06449944 0.02626687 9.1.6 Variance partitioning richness &lt;-genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() tibble(species=rep(species,3),metric=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;),r2=c(richness,neutral,phylogenetic)) %&gt;% write_tsv(paste0(&quot;results/var_&quot;,genus,&quot;.tsv&quot;)) 9.2 Natrix astreptophora 9.2.1 Retrieve data species=&quot;Natrix astreptophora&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0125/DMB0125_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0125/DMB0125_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0125/DMB0125_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0125/DMB0125.tree.gz&quot;, &quot;data/DMB0125.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0125.tree.gz&quot;) 9.2.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 9.2.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 9.2.4 Alpha diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=0) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(richness=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(neutral=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1,tree=genome_tree) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(phylogenetic=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) # Merge alpha diversities alpha_diversity &lt;- richness %&gt;% full_join(neutral,by=join_by(dataset==dataset)) %&gt;% full_join(phylogenetic,by=join_by(dataset==dataset)) # Write alpha diversities alpha_diversity %&gt;% write_tsv(paste0(&quot;results/alpha_&quot;,genus,&quot;.tsv&quot;)) # Print alpha diversity alpha_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(dataset==dataset)) %&gt;% group_by(Extraction) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_5syfync1wl0f50q827kk .table td.tinytable_css_zsdnw1f7whf8wh430ckg, .table th.tinytable_css_zsdnw1f7whf8wh430ckg { border-bottom: solid 0.1em #d3d8dc; } Extraction richness neutral phylogenetic DREX 37.5 16.30449 3.270384 EHEX 29.5 15.34095 3.211162 ZYMO 24.0 13.43764 3.065722 9.2.5 Beta diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;, out=&quot;pair&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;, out=&quot;pair&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;, out=&quot;pair&quot;) # Merge beta diversities beta_diversity &lt;- richness %&gt;% full_join(neutral,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% full_join(phylogenetic,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% rename(richness=C.x, neutral=C.y, phylogenetic=C) # Write beta diversities beta_diversity %&gt;% write_tsv(paste0(&quot;results/beta_&quot;,genus,&quot;.tsv&quot;)) # Print beta diversities beta_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(first==dataset)) %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(second==dataset)) %&gt;% mutate(relationship = case_when( Extraction.x == Extraction.y &amp; Sample.x != Sample.y ~ &quot;inter&quot;, Extraction.x != Extraction.y &amp; Sample.x == Sample.y ~ &quot;intra&quot;, TRUE ~ NA_character_ # Handle other cases if needed )) %&gt;% filter(relationship != is.na(relationship)) %&gt;% group_by(relationship) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_qkf7b7pmvbetftm642id .table td.tinytable_css_wo2a7adzaroduumnw481, .table th.tinytable_css_wo2a7adzaroduumnw481 { border-bottom: solid 0.1em #d3d8dc; } relationship richness neutral phylogenetic inter 0.5386629 0.65025916 0.18128644 intra 0.2756370 0.04665216 0.01166948 9.2.6 Variance partitioning richness &lt;-genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() tibble(species=rep(species,3),metric=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;),r2=c(richness,neutral,phylogenetic)) %&gt;% write_tsv(paste0(&quot;results/var_&quot;,genus,&quot;.tsv&quot;)) 9.3 Podarcis muralis 9.3.1 Retrieve data species=&quot;Podarcis muralis&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0128/DMB0128_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0128/DMB0128_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0128/DMB0128_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0128/DMB0128.tree.gz&quot;, &quot;data/DMB0128.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0128.tree.gz&quot;) 9.3.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 9.3.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 9.3.4 Alpha diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=0) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(richness=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(neutral=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1,tree=genome_tree) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(phylogenetic=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) # Merge alpha diversities alpha_diversity &lt;- richness %&gt;% full_join(neutral,by=join_by(dataset==dataset)) %&gt;% full_join(phylogenetic,by=join_by(dataset==dataset)) # Write alpha diversities alpha_diversity %&gt;% write_tsv(paste0(&quot;results/alpha_&quot;,genus,&quot;.tsv&quot;)) # Print alpha diversity alpha_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(dataset==dataset)) %&gt;% group_by(Extraction) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_uadht8ha3mkoybb01abw .table td.tinytable_css_mp66h3rbsof9v7huavqx, .table th.tinytable_css_mp66h3rbsof9v7huavqx { border-bottom: solid 0.1em #d3d8dc; } Extraction richness neutral phylogenetic DREX 80.5 33.09492 4.689994 EHEX 73.0 32.71816 4.716865 ZYMO 78.5 34.42602 4.745518 9.3.5 Beta diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;, out=&quot;pair&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;, out=&quot;pair&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;, out=&quot;pair&quot;) # Merge beta diversities beta_diversity &lt;- richness %&gt;% full_join(neutral,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% full_join(phylogenetic,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% rename(richness=C.x, neutral=C.y, phylogenetic=C) # Write beta diversities beta_diversity %&gt;% write_tsv(paste0(&quot;results/beta_&quot;,genus,&quot;.tsv&quot;)) # Print beta diversities beta_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(first==dataset)) %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(second==dataset)) %&gt;% mutate(relationship = case_when( Extraction.x == Extraction.y &amp; Sample.x != Sample.y ~ &quot;inter&quot;, Extraction.x != Extraction.y &amp; Sample.x == Sample.y ~ &quot;intra&quot;, TRUE ~ NA_character_ # Handle other cases if needed )) %&gt;% filter(relationship != is.na(relationship)) %&gt;% group_by(relationship) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_cpqpdqrpg6tkteayq32q .table td.tinytable_css_cadrr0a34v5nppmlbgdn, .table th.tinytable_css_cadrr0a34v5nppmlbgdn { border-bottom: solid 0.1em #d3d8dc; } relationship richness neutral phylogenetic inter 0.2864067 0.41508917 0.122770382 intra 0.0446703 0.00905735 0.003367558 9.3.6 Variance partitioning richness &lt;-genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() tibble(species=rep(species,3),metric=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;),r2=c(richness,neutral,phylogenetic)) %&gt;% write_tsv(paste0(&quot;results/var_&quot;,genus,&quot;.tsv&quot;)) "],["sample-digestion.html", "10 Sample homogeneisation and digestion 10.1 Instruments, plasticware and reagents 10.2 Protocol", " 10 Sample homogeneisation and digestion Homogenisation and digestion of biological samples like faeces or intestinal contents are crucial steps in the process of DNA extraction. These steps help break down the complex matrix of the sample, thus separating different compounds and molecules from each other. Faeces, for example, are composed of a heterogeneous mixture of materials, including undigested food, microbial cells, host cells, and waste products. This complex matrix can make it challenging to access and extract DNA. Homogenisation involves breaking down the solid and semi-solid components of the sample, creating a more uniform mixture that is easier to work with, while digestion also entails degrading cellular structures to release intracellular compounds to the matrix. The EHI samples are stored in a buffer that serves a dual purpose as both a preservative and a digestion buffer. The buffer facilitates the release of nucleic acids from cells and tissues through breaking down cellular membranes and structures. The EHI protocol also includes bead-beating using a combination of ceramic, silica and glass beads for sample homogenisation. The mechanical force generated by the beads’ movement and collision with the sample causes physical disruption, breaking apart cells and releasing their contents into the surrounding solution. Optimisation of bead-beating conditions is necessary to balance efficient disruption with minimal degradation, as depending on the sample, bead types, and shearing time, there is a potential risk of shearing or damaging sensitive biomolecules. 10.1 Instruments, plasticware and reagents Instruments Bead mill/beater homogenizer e.g. TissueLyser II (Qiagen) Analytical balance (for tissue sample) Block Heater-Shaker e.g. ThermoMixer C (Eppendorf) (for tissue sample) SAFE® Screw Cap De-/Capper (LVL technologies) SAFE® 2D/1D Code Reader (LVL technologies) Plasticware Item Brand Catalogue number Lysing Matrix E 96-Well Plate MP Biomedicals 116984001-CF Polystyrene Tweezer (Single packed disposable sterile) Megro Carbon steel surgical scalpel blades (Single packed sterile) 1C-X10-BL-CW-B-S LX 1000 - 2D Biobanking Tubes LVL technologies 1C-X10-BL-CW-B-S Reagents Reagent | Brand | Catalogue number | Storage | UltraPure™ 1M Tris Hydrochloride, Tris-HCI | Invitrogen | 15568025 | 4 ºC | UltraPure™ 0.5M Ethylenediaminetetraacetic acid, EDTA | Invitrogen | 15575-038 | 25 ºC | BioUltra Sodium dodecyl sulfate solution, SDS | Sigma Aldrich | 71736 | 25 ºC | Proteinase K 20 mg/ml | Roche | 3115828001 | 4 ºC | 10.2 Protocol Faeces and swabs Thaw the samples and ensure samples have entirely thawed. Spin down or gently centrifuge tubes briefly to remove any liquid from the lid. Add the content of 1 well of the Lysing Matrix E 96-Well Plate to each collection tube. Vortex to ensure that the beads are moving in each sample. If beads are not moving despite vortexing, it is an indication of overstuffing the sample. Consider using a sterile pipet tip to attempt unclogging the beads. Homogenise the sample with the TissueLyser for two rounds of 6 minutes at max speed (=30 Hz). Spin down or centrifuge the tubes at 2,2 g/rcf for 1 minute. Ensure no foam is present on the tube’s lids. Otherwise, repeat centrifugation. Gently transfer the supernatant to an LX 1000 LVL tube without disturbing the pellet+beads. Tissue samples Extract the tissue from the original preservation tube, dry it out and weight it on a sterile weighing boat. If the tissue sample is heavier than 10 mg, cut a portion using a sterile scalpel and place it in an Eppendorf tube Add 250 μl of SDS lysis buffer solution to the tube and 25 μl of proteinase K. Incubation overnight at 56°C on a a thermoshaker. Centrifuge/Spin Down** the tubes at 2,2 g/rcf for 1 minutes. Ensure no foam is present on the tube’s lids. Otherwise, repeat centrifugation. Transfer the digested sample to an LX 1000 LVL tube. "],["drex-dna-extraction.html", "11 DREX DNA extraction 11.1 Instruments, plasticware and reagents 11.2 Preparation of working reagents 11.3 Protocol", " 11 DREX DNA extraction DNA extraction involves isolating DNA molecules from the rest of organic materials in the mixture, as well as removing inhibitors such as polysaccharides, proteins and bile salts, which can affect downstream enzymatic reactions, such as adaptor ligation or PCR amplification. The DNA extraction procedure employed in the EHI involves DNA isolation using silica magnetic beads combined with solid-phase reversible immobilisation (SPRI) to remove as many inhibitors as possible. This technique takes advantage of the binding properties of silica magnetic beads to selectively capture DNA fragments, followed by the principle of SPRI to efficiently remove impurities and elute the purified DNA. 11.1 Instruments, plasticware and reagents Instruments Block Heater-Shaker such as ThermoMixer C (Eppendorf) (for tissue sample) Magnet compatible with V-Bottom 96-well plates such as Magnum™ EX Universal 96-well Magnet Plate (Alpaca, SKU: A000380) Fluorometer such as Qubit Flex Fluorometer (Invitrogen) SAFE® Screw Cap De-/Capper (LVL technologies) SAFE® 2D/1D Code Reader (LVL technologies) Plasticware Item Brand Catalogue number Millex-GP 0.22 µm Syringe Filter Millipore SLGV013SL Syringe (Single packed disposable sterile) 96-well V-shaped 1ml microplate 4titude 4ti-0125 XSX 200 - 2D Biobanking Tubes LVL technologies 1C-X02-BL-CW-B-L Self-adhesive aluminium foil LVL technologies AF100Plus Thin-walled polypropylene tubes with very low fluorescence compatible with Fluorometer such as Qubit Flex Assay Tube Strips Invitrogen Q33252 Stock reagents Reagent Brand Catalogue number Storage Deionized ultrapure water (ddH2O) Bionordika BN-51100 25 ºC Absolute ethanol, EtOH 25 ºC BioUltra Citric acid Sigma-Aldrich 27487 25 ºC BioUltra Citrate Concentrate Solution (1M) Sigma-Aldrich 83273-250ML-F 25 ºC Guanidine thiocyanate (GuSCN) Sigma-Aldrich G9277 25 ºC N-Lauroylsarcosine sodium salt solution Sigma-Aldrich L7414-50ML RT BioReagent 2-Isopropanol  Sigma-Aldrich I9516-500ML 25 ºC Hydrochloric acid solution (1M), HCl Sigma-Aldrich 25 ºC BioUltra Sodium Hydroxide solution (10M), NaOH Sigma-Aldrich 72068-100ML 25 ºC TWEEN® 20 Sigma-Aldrich P9416-50ML 25 ºC Silica magnetic beads G-Biosciences 786-916 4ºC Elution Buffer (EB) Qiagen 19086 25 ºC Qubit DNA HS Assay Kit Invitrogen Q32851 4 ºC Qubit DNA BR Assay Kit Invitrogen Q32850 4 ºC 11.2 Preparation of working reagents Citrate buffer (0.1 M, ph 5.0) To prepare a stock of 50ml: In a 50 mL centrifuge tube, prepare Citric acid stock solution (1 M) by dissolving 9.60 g of citric acid powder (molecular weight = 192.12 g/mol) in H2O to a final volume of 50 mL. In a 50 mL centrifuge tube, dilute Citric acid stock solution 1:10 to reach a 0.1 M solution with H2O. In a 50 mL centrifuge tube, dilute Trisodium citrate/Citrate Concentrate solution (1 M) 1:10 to reach a 0.1 M solution with H2O. In a 50 mL centrifuge tube, combine 17.5 mL of Citric acid solution (0.1 M) with 32.5 mL of Trisodium citrate/Citrate Concentrate solution (0.1 M). Check that pH is around 5.0 and adjust if needed using NAOH (10M). Buffer B To prepare a stock of 50ml: Weigh 29.54 g of Guanidine thiocyanate (GuSCN) using a large weighing boat. Add the GuSCN to a sterile PC or glass bottle (150 mL). Add 20 mL H2O, 5 mL of Citrate buffer (0.1 M) and a sterile stirring bar. Place the solution (approximately 45 mL) on the magnetic stirrer to dissolve completely. Add 2.5 mL of N-Lauroylsarcosine sodium salt solution (20%, pH 7-9). Add H2O to a final volume of 50 mL. Filter with a 0.22 µm Syringe Filter. Check that pH is around 5.0 and adjust if needed using NAOH (10M). Buffer C - DNA fraction To prepare a stock of 50ml: Weigh 11.82 g of Guanidine thiocyanate (GuSCN) using a large weighing boat. Add the GuSCN to a sterile PC or glass bottle (150 mL). Add 5 mL H2O, 5 mL of Citrate buffer (0.1 M) and a sterile stirring bar. Place the solution on the magnetic stirrer to dissolve completely. Add 30 mL of Isopropanol (2-Propanol). Add 25 µl of Tween20. Filter with a 0.22 µm Syringe Filter. Filter slowly to avoid filter overflowing. Check that pH is around 5.0 and adjust if needed using NAOH (10M). EBT buffer To prepare a stock of 50ml: In a 50 mL centrifuge tube, mix 50 ml of EB buffer with 25 µl of Tween20. Silica magnetic beads and buffer aliquots Switch on the Thermo Mixer and set to the right temperature. Equilibrate* the silica magnetic beads to room temperature for 30 min. Create the aliquots of reagents needed according to the table below. Prepare reagents for around 10% extra samples. Always ensure that beads are thoroughly resuspended before taking an aliquot. Working reagent Volume per sample Tube type Beads - DNA fraction 15 µl 2 mL Buffer B 200 µl 5/15/50 mL Buffer C - DNA fraction 200 µl 5/15/50 mL 80% EtOH - DNA washing 400 µl 5/15/50 mL Place the tube containing silica beads on a magnetic rack and wait until the beads are immobilised on the wall, and the supernatant is clear. Discard the clear supernatant. Add 2 mL of Tris-EDTA (TE) buffer to the tube. The TE buffer volume may be reduced according to the volume of the beads needed. The beads must be submerged during the wash step. Discard the supernatant. Repeat steps 6 and 7. Transfer “Beads - DNA fraction” to Buffer B. Mix well (by vortexing if you can avoid bubbles) the mixture “Beads - Buffer B”. 11.3 Protocol Ensure that the mixture “Beads - Buffer B” is properly mixed. Transfer 200 µl of the mixture to each well of the microplate. Ensure samples have entirely thawed. Vortex and centrifuge/spin down the LVL rack for 30 seconds to remove any liquid from the LVL tube lid. Transfer 200 μL of each sample to the plate. Seal the DNA plate with a self-adhesive aluminium foil and spin down. Incubate DNA plate: for 15 minutes at 10ºC with shaking at 1500 rpm. Spin down. Place the DNA plate on a magnetic rack and wait until the supernatant is clear. Discard the supernatant. Remove the DNA plate from the magnet. Add 200 µl of Buffer C to each well and mix well by pipetting. Cover the DNA plate with an aluminium seal and spin down shortly. Place the DNA plate on a magnetic rack and wait until the supernatant is clear. Discard the supernatant. Remove the DNA plate from the magnet. Add 200 µl of 80% EtOH and mix well by pipetting. Place the DNA plate on the magnetic rack and wait until the supernatant is clear. Discard the supernatant. Repeat step 18, briefly spin down the plate to bring EtOH residues down and repeat step 19. Ensure that all residual ethanol is removed. Dry the beads for at least 5 minutes. Remove the DNA plate from the magnet. Add 50 µl of EBT buffer. Cover the DNA plate with an aluminium seal and spin down shortly. Incubate DNA plate: 5 minutes at 25 ºC with shaking at 1500 rpm. Set up what needed for DNA quantification according to the Qubit Assay Protocol Spin down the DNA plate shortly at 1000 g. Place the DNA plate on a magnetic rack and wait until the supernatant is clear. Aspirate slowly (to avoid bead transfer) and transfer the supernatant with eluted DNA to a new plate. Place the plate on a magnetic rack. Transfer the DNA extract to a 200 µl LVL tube. Use 2 µl to selectively quantify DNA using the Qubit DNA HS or BR Assay Kit and a Qubit Fluorometer. Store the 200 µl LVL tube plate at -20ºC until further processing. "],["ehex-dna-extraction.html", "12 EHEX DNA extraction 12.1 Instruments, plasticware and reagents 12.2 Preparation of working reagents 12.3 Protocol", " 12 EHEX DNA extraction DNA extraction involves isolating DNA molecules from the rest of organic materials in the mixture, as well as removing inhibitors such as polysaccharides, proteins and bile salts, which can affect downstream enzymatic reactions, such as adaptor ligation or PCR amplification. The DNA extraction procedure employed in the EHI involves DNA isolation using silica magnetic beads combined with solid-phase reversible immobilisation (SPRI) to remove as many inhibitors as possible. This technique takes advantage of the binding properties of silica magnetic beads to selectively capture DNA fragments, followed by the principle of SPRI to efficiently remove impurities and elute the purified DNA. 12.1 Instruments, plasticware and reagents Instruments Block Heater-Shaker such as ThermoMixer C (Eppendorf) (for tissue sample) Magnet compatible with V-Bottom 96-well plates such as Magnum™ EX Universal 96-well Magnet Plate (Alpaca, SKU: A000380) Fluorometer such as Qubit Flex Fluorometer (Invitrogen) SAFE® Screw Cap De-/Capper (LVL technologies) SAFE® 2D/1D Code Reader (LVL technologies) Plasticware Item Brand Catalogue number Millex-GP 0.22 µm Syringe Filter Millipore SLGV013SL Syringe (Single packed disposable sterile) 96-well V-shaped 1ml microplate 4titude 4ti-0125 XSX 200 - 2D Biobanking Tubes LVL technologies 1C-X02-BL-CW-B-L Self-adhesive aluminium foil LVL technologies AF100Plus Thin-walled polypropylene tubes with very low fluorescence compatible with Fluorometer such as Qubit Flex Assay Tube Strips Invitrogen Q33252 Stock reagents Reagent Brand Catalogue number Storage Deionized ultrapure water (ddH2O) Bionordika BN-51100 25 ºC Absolute ethanol, EtOH 25 ºC BioUltra Citric acid Sigma-Aldrich 27487 25 ºC BioUltra Citrate Concentrate Solution (1M) Sigma-Aldrich 83273-250ML-F 25 ºC Guanidine thiocyanate (GuSCN) Sigma-Aldrich G9277 25 ºC N-Lauroylsarcosine sodium salt solution Sigma-Aldrich L7414-50ML RT BioReagent 2-Isopropanol  Sigma-Aldrich I9516-500ML 25 ºC Hydrochloric acid solution (1M), HCl Sigma-Aldrich 25 ºC BioUltra Sodium Hydroxide solution (10M), NaOH Sigma-Aldrich 72068-100ML 25 ºC TWEEN® 20 Sigma-Aldrich P9416-50ML 25 ºC Silica magnetic beads G-Biosciences 786-916 4ºC Elution Buffer (EB) Qiagen 19086 25 ºC Qubit DNA HS Assay Kit Invitrogen Q32851 4 ºC Qubit DNA BR Assay Kit Invitrogen Q32850 4 ºC 12.2 Preparation of working reagents Citrate buffer (0.1 M, ph 5.0) To prepare a stock of 50ml: In a 50 mL centrifuge tube, prepare Citric acid stock solution (1 M) by dissolving 9.60 g of citric acid powder (molecular weight = 192.12 g/mol) in H2O to a final volume of 50 mL. In a 50 mL centrifuge tube, dilute Citric acid stock solution 1:10 to reach a 0.1 M solution with H2O. In a 50 mL centrifuge tube, dilute Trisodium citrate/Citrate Concentrate solution (1 M) 1:10 to reach a 0.1 M solution with H2O. In a 50 mL centrifuge tube, combine 17.5 mL of Citric acid solution (0.1 M) with 32.5 mL of Trisodium citrate/Citrate Concentrate solution (0.1 M). Check that pH is around 5.0 and adjust if needed using NAOH (10M). Buffer B To prepare a stock of 50ml: Weigh 29.54 g of Guanidine thiocyanate (GuSCN) using a large weighing boat. Add the GuSCN to a sterile PC or glass bottle (150 mL). Add 20 mL H2O, 5 mL of Citrate buffer (0.1 M) and a sterile stirring bar. Place the solution (approximately 45 mL) on the magnetic stirrer to dissolve completely. Add 2.5 mL of N-Lauroylsarcosine sodium salt solution (20%, pH 7-9). Add H2O to a final volume of 50 mL. Filter with a 0.22 µm Syringe Filter. Check that pH is around 5.0 and adjust if needed using NAOH (10M). Buffer C - DNA fraction To prepare a stock of 50ml: Weigh 11.82 g of Guanidine thiocyanate (GuSCN) using a large weighing boat. Add the GuSCN to a sterile PC or glass bottle (150 mL). Add 5 mL H2O, 5 mL of Citrate buffer (0.1 M) and a sterile stirring bar. Place the solution on the magnetic stirrer to dissolve completely. Add 30 mL of Isopropanol (2-Propanol). Add 25 µl of Tween20. Filter with a 0.22 µm Syringe Filter. Filter slowly to avoid filter overflowing. Check that pH is around 5.0 and adjust if needed using NAOH (10M). EBT buffer To prepare a stock of 50ml: In a 50 mL centrifuge tube, mix 50 ml of EB buffer with 25 µl of Tween20. Silica magnetic beads and buffer aliquots Switch on the Thermo Mixer and set to the right temperature. Equilibrate* the silica magnetic beads to room temperature for 30 min. Create the aliquots of reagents needed according to the table below. Prepare reagents for around 10% extra samples. Always ensure that beads are thoroughly resuspended before taking an aliquot. Working reagent Volume per sample Tube type Beads - DNA fraction 15 µl 2 mL Buffer B 200 µl 5/15/50 mL Buffer C - DNA fraction 200 µl 5/15/50 mL 80% EtOH - DNA washing 400 µl 5/15/50 mL Place the tube containing silica beads on a magnetic rack and wait until the beads are immobilised on the wall, and the supernatant is clear. Discard the clear supernatant. Add 2 mL of Tris-EDTA (TE) buffer to the tube. The TE buffer volume may be reduced according to the volume of the beads needed. The beads must be submerged during the wash step. Discard the supernatant. Repeat steps 6 and 7. Transfer “Beads - DNA fraction” to Buffer B. Mix well (by vortexing if you can avoid bubbles) the mixture “Beads - Buffer B”. 12.3 Protocol Ensure that the mixture “Beads - Buffer B” is properly mixed. Transfer 200 µl of the mixture to each well of the microplate. Ensure samples have entirely thawed. Vortex and centrifuge/spin down the LVL rack for 30 seconds to remove any liquid from the LVL tube lid. Transfer 200 μL of each sample to the plate. Seal the DNA plate with a self-adhesive aluminium foil and spin down. Incubate DNA plate: for 15 minutes at 10ºC with shaking at 1500 rpm. Spin down. Place the DNA plate on a magnetic rack and wait until the supernatant is clear. Discard the supernatant. Remove the DNA plate from the magnet. Add 200 µl of Buffer C to each well and mix well by pipetting. Cover the DNA plate with an aluminium seal and spin down shortly. Place the DNA plate on a magnetic rack and wait until the supernatant is clear. Discard the supernatant. Remove the DNA plate from the magnet. Add 200 µl of 80% EtOH and mix well by pipetting. Place the DNA plate on the magnetic rack and wait until the supernatant is clear. Discard the supernatant. Repeat step 18, briefly spin down the plate to bring EtOH residues down and repeat step 19. Ensure that all residual ethanol is removed. Dry the beads for at least 5 minutes. Remove the DNA plate from the magnet. Add 50 µl of EBT buffer. Cover the DNA plate with an aluminium seal and spin down shortly. Incubate DNA plate: 5 minutes at 25 ºC with shaking at 1500 rpm. Set up what needed for DNA quantification according to the Qubit Assay Protocol Spin down the DNA plate shortly at 1000 g. Place the DNA plate on a magnetic rack and wait until the supernatant is clear. Aspirate slowly (to avoid bead transfer) and transfer the supernatant with eluted DNA to a new plate. Place the plate on a magnetic rack. Transfer the DNA extract to a 200 µl LVL tube. Use 2 µl to selectively quantify DNA using the Qubit DNA HS or BR Assay Kit and a Qubit Fluorometer. Store the 200 µl LVL tube plate at -20ºC until further processing. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
