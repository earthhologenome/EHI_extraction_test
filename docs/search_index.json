[["index.html", "Earth Hologenome Initiative | Lauritsen et al. 2024 Robust, open-source, and automation-friendly DNA extraction protocol for hologenomic research 1 Introduction 1.1 Prepare the R environment", " Earth Hologenome Initiative | Lauritsen et al. 2024 Robust, open-source, and automation-friendly DNA extraction protocol for hologenomic research Jonas G. Laurisen, Christian Carøe, Nanna Gaun, Garazi Martin, Aoife Leonard, Raphael Eisenhofer, M Thomas P Gilbert, Ostaizka Aizpurua, Antton Alberdi1, Carlotta Pietroni 2024-04-29 1 Introduction This webbook contains all the code used for the comparative study on the generation of metagenomic data from faeces of various species using three extraction methods. 1.1 Prepare the R environment 1.1.1 Environment To reproduce all the analyses locally, clone this repository in your computer using: RStudio &gt; New Project &gt; Version Control &gt; Git And indicating the following git repository: https://github.com/earthhologenome/EHI_extraction_test.git Once the R project has been created, follow the instructions and code chunks shown in this webbook. 1.1.2 Libraries The following R packages are required for the data analysis. # Base library(R.utils) library(knitr) library(tidyverse) library(rairtable) library(devtools) library(tinytable) library(broom) library(broom.mixed) # For tree handling library(ape) library(phyloseq) library(phytools) # For plotting library(ggplot2) library(ggrepel) library(ggpubr) library(ggnewscale) library(gridExtra) library(ggtreeExtra) library(ggtree) library(ggh4x) # For statistics library(spaa) library(vegan) library(Rtsne) library(geiger) library(hilldiv2) library(distillR) library(ANCOMBC) library(lme4) University of Copenhagen, antton.alberdi@sund.ku.dk↩︎ "],["laboratory-performance.html", "2 Laboratory performance 2.1 Load data 2.2 DNA yield 2.3 Library performance", " 2 Laboratory performance 2.1 Load data Load data previously compiled from the database: all_data &lt;- read_tsv(&quot;data/all_data.tsv&quot;) 2.2 DNA yield Total amount of DNA extracted from the 150 ul subset of the bead-beaten sample. all_data %&gt;% group_by(Taxon,Extraction) %&gt;% summarise(value = sprintf(&quot;%.0f±%.0f&quot;, mean(extract), sd(extract))) %&gt;% pivot_wider(names_from = Extraction, values_from = value) %&gt;% tt(caption = &quot;Mean and standard deviation of total DNA nanograms&quot;) tinytable_28a74i0azlc5qs0fzoju .table td.tinytable_css_eiag3csobrpkbk595r7l, .table th.tinytable_css_eiag3csobrpkbk595r7l { border-bottom: solid 0.1em #d3d8dc; } Mean and standard deviation of total DNA nanograms Taxon DREX EHEX ZYMO Amphibian 482±546 1733±1145 471±347 Bird 13±12 54±45 73±127 Control 2±3 1±0 0±0 Mammal 265±214 904±672 445±394 Reptile 162±128 250±171 102±68 all_data %&gt;% ggplot(aes(x=Extraction,y=extract))+ geom_boxplot() + facet_grid(. ~ Taxon, scales = &quot;free&quot;) + labs(y=&quot;DNA yield (ng)&quot;,x=&quot;Extraction method&quot;) all_data %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% lmerTest::lmer(extract ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_lgdbg7uvb39s4yilzgk8 .table td.tinytable_css_k3h46fr8o7zmp1ojflqo, .table th.tinytable_css_k3h46fr8o7zmp1ojflqo { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 120.70599 125.49705 0.9618233 16.14808 3.503209e-01 fixed NA ExtractionEHEX 620.27971 74.78157 8.2945532 153.30986 5.196360e-14 fixed NA ExtractionZYMO 39.65796 74.42689 0.5328445 153.24421 5.949131e-01 ran_pars Sample sd__(Intercept) 164.00812 NA NA NA NA ran_pars Species sd__(Intercept) 374.85139 NA NA NA NA ran_pars Residual sd__Observation 400.80106 NA NA NA NA 2.3 Library performance Number of PCR cycles required for reaching the plateau phase of the indexing PCR. all_data %&gt;% group_by(Taxon,Extraction) %&gt;% summarise(value = sprintf(&quot;%.1f±%.1f&quot;, mean(pcr), sd(pcr))) %&gt;% pivot_wider(names_from = Extraction, values_from = value) %&gt;% tt(caption = &quot;Mean and standard deviation of optimal number of PCR cycles&quot;) tinytable_v5jij3i7f545nfjjfbc2 .table td.tinytable_css_axlwnj1wile1448qiupa, .table th.tinytable_css_axlwnj1wile1448qiupa { border-bottom: solid 0.1em #d3d8dc; } Mean and standard deviation of optimal number of PCR cycles Taxon DREX EHEX ZYMO Amphibian 10.7±2.9 10.7±2.3 14.3±1.6 Bird 18.7±4.3 14.4±2.3 17.6±2.8 Control 19.8±0.5 22.0±4.2 20.0±2.8 Mammal 9.9±1.9 10.0±2.1 11.1±3.5 Reptile 10.3±3.5 12.0±3.3 11.7±4.0 all_data %&gt;% ggplot(aes(x=Extraction,y=pcr))+ geom_boxplot() + facet_grid(. ~ Taxon, scales = &quot;free&quot;) + labs(y=&quot;Optimal number of PCR cycles&quot;,x=&quot;Extraction method&quot;) all_data %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% lmerTest::lmer(pcr ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_6pvfvctr7us0hgsivgdj .table td.tinytable_css_wxv84t3fwekaa84yd695, .table th.tinytable_css_wxv84t3fwekaa84yd695 { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 12.2930699 0.8648942 14.213380 14.90821 4.500117e-10 fixed NA ExtractionEHEX -0.5222953 0.5130831 -1.017955 150.84234 3.103294e-01 fixed NA ExtractionZYMO 1.5689655 0.5106532 3.072468 150.76244 2.519836e-03 ran_pars Sample sd__(Intercept) 1.0689643 NA NA NA NA ran_pars Species sd__(Intercept) 2.5992293 NA NA NA NA ran_pars Residual sd__Observation 2.7499517 NA NA NA NA "],["sequencing-data.html", "3 Sequencing data 3.1 Sequencing depth 3.2 Quality-filtering", " 3 Sequencing data 3.1 Sequencing depth tibble(metric=c(&quot;Total GB&quot;, &quot;Total reads&quot;, &quot;Average GB&quot;, &quot;Average reads&quot;), value=unlist(c(round(all_data %&gt;% summarise(sum(bases_pre_fastp)) / 1000000000,2), round(all_data %&gt;% summarise(sum(bases_pre_fastp)) / 300,2), paste0(round(all_data %&gt;% summarise(mean(bases_pre_fastp)) / 1000000000,2),&quot;±&quot;,round(all_data %&gt;% summarise(sd(bases_pre_fastp)) / 1000000000,2)), paste0(round(all_data %&gt;% summarise(mean(bases_pre_fastp)) / 300,0),&quot;±&quot;,round(all_data %&gt;% summarise(sd(bases_pre_fastp)) / 300,0)))) ) %&gt;% tt() tinytable_gj1kkkrl31rmub4op5am .table td.tinytable_css_hrhb4h9cdixk1n3phf9t, .table th.tinytable_css_hrhb4h9cdixk1n3phf9t { border-bottom: solid 0.1em #d3d8dc; } metric value Total GB 937.37 Total reads 3124578099 Average GB 5.18±2.46 Average reads 17262862±8195554 all_data %&gt;% group_by(Taxon,Extraction) %&gt;% summarise(value = sprintf(&quot;%.1f±%.1f&quot;, mean(bases_post_fastp / 1000000000), sd(bases_post_fastp / 1000000000))) %&gt;% pivot_wider(names_from = Extraction, values_from = value) %&gt;% tt(caption = &quot;Mean and standard deviation of sequencing depth (GB)&quot;) tinytable_fj8yqj4lzdkg88gn7stb .table td.tinytable_css_18kzryi8f6mdlgcligw7, .table th.tinytable_css_18kzryi8f6mdlgcligw7 { border-bottom: solid 0.1em #d3d8dc; } Mean and standard deviation of sequencing depth (GB) Taxon DREX EHEX ZYMO Amphibian 3.2±2.1 4.7±0.3 4.0±1.6 Bird 4.2±2.4 3.1±1.9 3.9±1.8 Control 0.5±0.6 2.1±2.7 0.0±0.0 Mammal 4.6±2.0 3.8±2.2 5.4±3.2 Reptile 5.7±1.3 5.0±1.8 6.1±2.2 all_data %&gt;% ggplot(aes(x=Extraction,y=bases_pre_fastp))+ geom_boxplot() + facet_grid(. ~ Taxon, scales = &quot;free&quot;) + labs(y=&quot;DNA yield (ng)&quot;,x=&quot;Extraction method&quot;) all_data %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% lmerTest::lmer(bases_post_fastp ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_1guxqguef86vgxs0wf07 .table td.tinytable_css_m1mdut5ml25g84zj76dz, .table th.tinytable_css_m1mdut5ml25g84zj76dz { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 4322719741 382290022 11.30743545 1.711860e+01 2.299227e-09 fixed NA ExtractionEHEX 10864597 284400639 0.03820173 1.443429e+09 9.695268e-01 fixed NA ExtractionZYMO 485437083 283030980 1.71513762 4.313942e+21 8.632000e-02 ran_pars Sample sd__(Intercept) 1407267694 NA NA NA NA ran_pars Species sd__(Intercept) 508228833 NA NA NA NA ran_pars Residual sd__Observation 1524168473 NA NA NA NA 3.2 Quality-filtering all_data %&gt;% mutate(qf_bases=bases_post_fastp/bases_pre_fastp*100) %&gt;% group_by(Taxon,Extraction) %&gt;% summarise(value = sprintf(&quot;%.1f±%.1f&quot;, mean(qf_bases), sd(qf_bases))) %&gt;% pivot_wider(names_from = Extraction, values_from = value) %&gt;% tt(caption = &quot;Mean and standard deviation of quality-filtered proportion of reads&quot;) tinytable_y3sdk8zxyvk07ta0lav9 .table td.tinytable_css_cwhigb77axumg7noaldr, .table th.tinytable_css_cwhigb77axumg7noaldr { border-bottom: solid 0.1em #d3d8dc; } Mean and standard deviation of quality-filtered proportion of reads Taxon DREX EHEX ZYMO Amphibian 91.7±3.7 87.6±2.9 84.7±1.2 Bird 70.3±23.0 70.2±14.7 70.9±16.1 Control 9.8±11.5 27.5±3.4 3.3±2.3 Mammal 89.5±4.7 91.2±1.9 91.9±2.3 Reptile 90.5±7.1 88.3±7.2 89.9±6.3 all_data %&gt;% mutate(qf_bases=bases_post_fastp/bases_pre_fastp*100) %&gt;% ggplot(aes(x=Extraction,y=qf_bases))+ geom_boxplot() + facet_grid(. ~ Taxon, scales = &quot;free&quot;) + labs(y=&quot;DNA yield (ng)&quot;,x=&quot;Extraction method&quot;) all_data %&gt;% mutate(qf_bases=bases_post_fastp/bases_pre_fastp*100) %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% lmerTest::lmer(qf_bases ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_kdhhaj4s699vcsx9ljs5 .table td.tinytable_css_ip61mabacz2c2w1pcdpj, .table th.tinytable_css_ip61mabacz2c2w1pcdpj { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 84.867885 3.229677 26.2775145 12.92142 1.337096e-12 fixed NA ExtractionEHEX -1.238440 1.268390 -0.9763877 145.71392 3.304905e-01 fixed NA ExtractionZYMO -1.811218 1.262245 -1.4349184 145.69071 1.534536e-01 ran_pars Sample sd__(Intercept) 7.418801 NA NA NA NA ran_pars Species sd__(Intercept) 9.356829 NA NA NA NA ran_pars Residual sd__Observation 6.797395 NA NA NA NA "],["genomic-data.html", "4 Genomic data 4.1 Read duplicates 4.2 Depth of coverage 4.3 Breadth of coverage", " 4 Genomic data 4.1 Read duplicates all_data %&gt;% select(dataset,Extraction,duplicates,Taxon) %&gt;% unique() %&gt;% group_by(Taxon,Extraction) %&gt;% summarise(value = sprintf(&quot;%.1f±%.1f&quot;, mean(duplicates), sd(duplicates))) %&gt;% pivot_wider(names_from = Extraction, values_from = value) %&gt;% tt(caption = &quot;Mean and standard deviation of fraction of duplicated reads&quot;) tinytable_7c0az2p7y96m2rjip6xl .table td.tinytable_css_lsrrjlzqvy0arid5xpkv, .table th.tinytable_css_lsrrjlzqvy0arid5xpkv { border-bottom: solid 0.1em #d3d8dc; } Mean and standard deviation of fraction of duplicated reads Taxon DREX EHEX ZYMO Amphibian 0.2±0.2 0.2±0.2 0.3±0.2 Bird 0.9±0.1 0.6±0.4 0.8±0.3 Control 0.9±0.0 1.0±0.0 1.0±0.0 Mammal 0.2±0.1 0.2±0.2 0.4±0.4 Reptile 0.3±0.3 0.4±0.4 0.5±0.4 all_data %&gt;% select(dataset,Extraction,duplicates,Taxon) %&gt;% unique() %&gt;% mutate(Taxon=factor(Taxon,levels=c(&quot;Amphibian&quot;,&quot;Reptile&quot;,&quot;Mammal&quot;,&quot;Bird&quot;,&quot;Control&quot;))) %&gt;% mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(aes(x=Extraction,y=duplicates))+ geom_boxplot() + facet_grid(. ~ Taxon, scales = &quot;free&quot;) + labs(y=&quot;Duplication rate&quot;,x=&quot;Extraction method&quot;) all_data %&gt;% select(dataset,Sample,Species,Extraction,duplicates,Taxon) %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% lmerTest::lmer(duplicates ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_171zculjd8c8psm2h61h .table td.tinytable_css_vj19sdfzqcei9hdsynih, .table th.tinytable_css_vj19sdfzqcei9hdsynih { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 0.39361067 0.07257915 5.423192 14.33359 8.267782e-05 fixed NA ExtractionEHEX -0.05339005 0.03918499 -1.362513 160.73104 1.749423e-01 fixed NA ExtractionZYMO 0.09279626 0.03900562 2.379048 160.72377 1.853073e-02 ran_pars Sample sd__(Intercept) 0.00000000 NA NA NA NA ran_pars Species sd__(Intercept) 0.23148121 NA NA NA NA ran_pars Residual sd__Observation 0.21005171 NA NA NA NA 4.2 Depth of coverage all_data %&gt;% select(dataset,Extraction,coverage_depth,Taxon) %&gt;% unique() %&gt;% group_by(Taxon,Extraction) %&gt;% summarise(value = sprintf(&quot;%.1f±%.1f&quot;, mean(coverage_depth), sd(coverage_depth))) %&gt;% pivot_wider(names_from = Extraction, values_from = value) %&gt;% tt(caption = &quot;Mean and standard deviation of fraction of duplicated reads&quot;) tinytable_cj4ehdohrsqvx8h9nn8x .table td.tinytable_css_a5srp8faylfykdre4aiu, .table th.tinytable_css_a5srp8faylfykdre4aiu { border-bottom: solid 0.1em #d3d8dc; } Mean and standard deviation of fraction of duplicated reads Taxon DREX EHEX ZYMO Amphibian 0.0±0.0 0.0±0.0 0.0±0.0 Bird 0.6±0.5 0.8±0.8 0.4±0.8 Control 0.0±0.0 0.0±0.0 0.0±0.0 Mammal 0.3±0.4 0.5±1.0 0.7±1.2 Reptile 0.1±0.1 0.1±0.1 0.2±0.3 all_data %&gt;% select(dataset,Extraction,coverage_depth,Taxon) %&gt;% unique() %&gt;% mutate(Taxon=factor(Taxon,levels=c(&quot;Amphibian&quot;,&quot;Reptile&quot;,&quot;Mammal&quot;,&quot;Bird&quot;,&quot;Control&quot;))) %&gt;% mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(aes(x=Extraction,y=coverage_depth))+ geom_boxplot() + facet_grid(. ~ Taxon, scales = &quot;free&quot;) + labs(y=&quot;Depth of coverage&quot;,x=&quot;Extraction method&quot;) all_data %&gt;% select(dataset,Sample,Species,Extraction,coverage_depth,Taxon) %&gt;% unique() %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% lmerTest::lmer(coverage_depth ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_uezua2r41tz836tqbm7y .table td.tinytable_css_hao400wvtunge9wglgl3, .table th.tinytable_css_hao400wvtunge9wglgl3 { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 0.23933333 0.1331063 1.7980622 20.58494 0.0868510 fixed NA ExtractionEHEX 0.08700000 0.1144640 0.7600640 48.00000 0.4509335 fixed NA ExtractionZYMO 0.08979167 0.1144640 0.7844531 48.00000 0.4366287 ran_pars Sample sd__(Intercept) 0.40863458 NA NA NA NA ran_pars Species sd__(Intercept) 0.22473121 NA NA NA NA ran_pars Residual sd__Observation 0.39651507 NA NA NA NA 4.3 Breadth of coverage all_data %&gt;% select(dataset,Extraction,coverage_breadth,Taxon) %&gt;% unique() %&gt;% group_by(Taxon,Extraction) %&gt;% summarise(value = sprintf(&quot;%.1f±%.1f&quot;, mean(coverage_breadth), sd(coverage_breadth))) %&gt;% pivot_wider(names_from = Extraction, values_from = value) %&gt;% tt(caption = &quot;Mean and standard deviation of depth of host genome coverage&quot;) tinytable_h4kmi71tafw9a17ypn4b .table td.tinytable_css_1u0bzkxvwyffvfoz8day, .table th.tinytable_css_1u0bzkxvwyffvfoz8day { border-bottom: solid 0.1em #d3d8dc; } Mean and standard deviation of depth of host genome coverage Taxon DREX EHEX ZYMO Amphibian 0.0±0.0 0.0±0.0 0.0±0.0 Bird 3.2±4.4 8.9±13.9 0.6±0.5 Control 0.0±0.0 0.0±0.0 0.0±0.0 Mammal 10.2±16.4 15.1±26.4 5.7±5.9 Reptile 3.0±5.4 2.9±3.7 4.9±7.5 all_data %&gt;% select(dataset,Extraction,coverage_breadth,Taxon) %&gt;% unique() %&gt;% mutate(Taxon=factor(Taxon,levels=c(&quot;Amphibian&quot;,&quot;Reptile&quot;,&quot;Mammal&quot;,&quot;Bird&quot;,&quot;Control&quot;))) %&gt;% mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(aes(x=Extraction,y=coverage_breadth))+ geom_boxplot() + facet_grid(. ~ Taxon, scales = &quot;free&quot;) + labs(y=&quot;Breadth of coverage&quot;,x=&quot;Extraction method&quot;) all_data %&gt;% select(dataset,Extraction,Sample,Species,coverage_breadth,Taxon) %&gt;% unique() %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% lmerTest::lmer(coverage_breadth ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_aqgng9yy5dvdrgm75m4y .table td.tinytable_css_yjun23pryupdyvxf6zqp, .table th.tinytable_css_yjun23pryupdyvxf6zqp { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 4.100417 2.252826 1.8201211 20.82558 0.08314479 fixed NA ExtractionEHEX 2.617500 1.956426 1.3378986 48.00000 0.18723379 fixed NA ExtractionZYMO -1.301250 1.956426 -0.6651158 48.00000 0.50915975 ran_pars Sample sd__(Intercept) 7.118462 NA NA NA NA ran_pars Species sd__(Intercept) 3.549767 NA NA NA NA ran_pars Residual sd__Observation 6.777259 NA NA NA NA "],["metagenomic-data.html", "5 Metagenomic data 5.1 Library complexity 5.2 Alpha diversity 5.3 Microbial complexity recovery 5.4 Variance partitioning 5.5 Combined community analysis", " 5 Metagenomic data Species-specific community analyses conducted to generate the data included in these analyses can be found in the annex. Amphibians Calotriton asper Lissotriton helveticus Salamandra atra Birds Geospizopsis unicolor Perisoreus infaustus Zonotrichia capensis Mammals Plecotus auritus Sciurus carolinensis Trichosurus vulpecula Reptiles Chalcides striatus Natrix astreptophora Podarcis muralis 5.1 Library complexity Nonpareil estimate of the metagenomic complexity after removing host DNA. all_data %&gt;% select(dataset,Extraction,nonpareil,Taxon) %&gt;% unique() %&gt;% group_by(Taxon,Extraction) %&gt;% summarise(value = sprintf(&quot;%.1f±%.1f&quot;, mean(nonpareil), sd(nonpareil))) %&gt;% pivot_wider(names_from = Extraction, values_from = value) %&gt;% tt(caption = &quot;Mean and standard deviation of breadth of host genome coverage&quot;) tinytable_9hpca6vkb9d0l8f4lw2x .table td.tinytable_css_wm51tt6483qh3o48atl9, .table th.tinytable_css_wm51tt6483qh3o48atl9 { border-bottom: solid 0.1em #d3d8dc; } Mean and standard deviation of breadth of host genome coverage Taxon DREX EHEX ZYMO Amphibian 0.8±0.1 0.8±0.1 0.9±0.1 Bird 1.0±0.0 0.8±0.4 0.9±0.1 Control 0.5±0.6 0.5±0.7 0.0±0.0 Mammal 0.8±0.1 0.7±0.3 0.8±0.2 Reptile 0.9±0.0 0.9±0.1 0.9±0.1 all_data %&gt;% select(dataset,Extraction,nonpareil,Taxon) %&gt;% unique() %&gt;% mutate(Taxon=factor(Taxon,levels=c(&quot;Amphibian&quot;,&quot;Reptile&quot;,&quot;Mammal&quot;,&quot;Bird&quot;,&quot;Control&quot;))) %&gt;% mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(aes(x=Extraction,y=nonpareil))+ geom_boxplot() + facet_grid(. ~ Taxon, scales = &quot;free&quot;) + labs(y=&quot;Nonpareil completeness&quot;,x=&quot;Extraction method&quot;) all_data %&gt;% select(dataset,Extraction,Sample,Species,nonpareil,Taxon) %&gt;% unique() %&gt;% mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% lmerTest::lmer(nonpareil ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_o1m91po2hkp3ez668rg9 .table td.tinytable_css_h8tmncuyw7oo2q48cz0p, .table th.tinytable_css_h8tmncuyw7oo2q48cz0p { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 0.885552853 0.03450229 25.6664948 40.89542 7.753071e-27 fixed NA ExtractionDREX 0.005536892 0.04336611 0.1276779 48.00020 8.989373e-01 fixed NA ExtractionEHEX -0.112193866 0.04336611 -2.5871326 48.00020 1.276294e-02 ran_pars Sample sd__(Intercept) 0.059565487 NA NA NA NA ran_pars Species sd__(Intercept) 0.035030813 NA NA NA NA ran_pars Residual sd__Observation 0.150224598 NA NA NA NA 5.2 Alpha diversity Variance partitioning metrics are derived from community_analysis.Rmd. alpha_data &lt;- list.files(path = &quot;results&quot;, pattern = &quot;^alpha_.*\\\\.tsv$&quot;, full.names = TRUE) %&gt;% map_df(~ read_tsv(.)) %&gt;% left_join(all_data,by= join_by(dataset==dataset)) alpha_data %&gt;% pivot_longer(!c(dataset,Library,Species,Taxon,Sample,Extraction), names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% mutate(metric=factor(metric,levels=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;))) %&gt;% mutate(Taxon=factor(Taxon,levels=c(&quot;Amphibian&quot;,&quot;Reptile&quot;,&quot;Mammal&quot;))) %&gt;% mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(aes(x=Extraction,y=value))+ geom_boxplot() + facet_grid(metric ~ Taxon, scales = &quot;free&quot;) 5.2.1 Richness alpha_data %&gt;% select(dataset,Extraction,Sample,Species,richness,Taxon) %&gt;% unique() %&gt;% mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% lmerTest::lmer(richness ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_pjvr89dadesyvmnjddm5 .table td.tinytable_css_qq9vm9g2i2n9u8xtctuf, .table th.tinytable_css_qq9vm9g2i2n9u8xtctuf { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 59.44444444 10.715517 5.5475108 10.12322 0.000234351 fixed NA ExtractionDREX 0.05555556 4.453352 0.0124750 34.97883 0.990117532 fixed NA ExtractionEHEX 1.38257472 4.545332 0.3041746 35.13134 0.762789322 ran_pars Sample sd__(Intercept) 16.00359332 NA NA NA NA ran_pars Species sd__(Intercept) 28.56742258 NA NA NA NA ran_pars Residual sd__Observation 13.36005511 NA NA NA NA 5.2.2 Neutral alpha_data %&gt;% select(dataset,Extraction,Sample,Species,neutral,Taxon) %&gt;% unique() %&gt;% mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% lmerTest::lmer(neutral ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_08bhf8uublqlvroqt3fp .table td.tinytable_css_pdj3zqa9z7p6zargy4yd, .table th.tinytable_css_pdj3zqa9z7p6zargy4yd { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 29.5413181 5.139162 5.7482754 9.895197 0.000193227 fixed NA ExtractionDREX -2.1102758 1.922343 -1.0977625 35.042971 0.279794105 fixed NA ExtractionEHEX -0.3422373 1.962694 -0.1743712 35.152526 0.862574163 ran_pars Sample sd__(Intercept) 8.6429526 NA NA NA NA ran_pars Species sd__(Intercept) 13.5543072 NA NA NA NA ran_pars Residual sd__Observation 5.7670282 NA NA NA NA 5.2.3 Phylogenetic alpha_data %&gt;% select(dataset,Extraction,Sample,Species,phylogenetic,Taxon) %&gt;% unique() %&gt;% mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% lmerTest::lmer(phylogenetic ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_etsa3nifli19n6jldv5m .table td.tinytable_css_rd1n7rw3r4oh2fqvysym, .table th.tinytable_css_rd1n7rw3r4oh2fqvysym { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 4.7721984 0.4324985 11.034024 9.653749 8.685116e-07 fixed NA ExtractionDREX 0.1521100 0.1403528 1.083769 35.015284 2.858737e-01 fixed NA ExtractionEHEX 0.1852709 0.1433723 1.292236 35.056809 2.047290e-01 ran_pars Sample sd__(Intercept) 1.2179889 NA NA NA NA ran_pars Species sd__(Intercept) 0.9236345 NA NA NA NA ran_pars Residual sd__Observation 0.4210584 NA NA NA NA 5.3 Microbial complexity recovery all_data %&gt;% select(dataset,Extraction,microbial_fraction,MAG_mapping_percentage,Taxon) %&gt;% mutate(damr=pmin(1,MAG_mapping_percentage/(microbial_fraction*100))) %&gt;% mutate(damr=ifelse(is.na(damr),0,damr)) %&gt;% unique() %&gt;% group_by(Taxon,Extraction) %&gt;% summarise(value = sprintf(&quot;%.1f±%.1f&quot;, mean(damr), sd(damr))) %&gt;% pivot_wider(names_from = Extraction, values_from = value) %&gt;% tt(caption = &quot;Mean and standard deviation of breadth of host genome coverage&quot;) tinytable_scajeu357qawp1ypxx2g .table td.tinytable_css_gghhs3a6ske1rjm1uonn, .table th.tinytable_css_gghhs3a6ske1rjm1uonn { border-bottom: solid 0.1em #d3d8dc; } Mean and standard deviation of breadth of host genome coverage Taxon DREX EHEX ZYMO Amphibian 0.8±0.3 0.8±0.3 0.8±0.4 Bird 0.5±0.4 0.6±0.4 0.6±0.4 Control 1.0±0.0 1.0±0.0 1.0±0.0 Mammal 0.9±0.1 0.8±0.3 0.8±0.1 Reptile 1.0±0.0 1.0±0.0 0.9±0.1 all_data %&gt;% select(dataset,Extraction,microbial_fraction,MAG_mapping_percentage,Taxon) %&gt;% mutate(damr=pmin(1,MAG_mapping_percentage/(microbial_fraction*100))) %&gt;% mutate(damr=ifelse(is.na(damr),0,damr)) %&gt;% unique() %&gt;% mutate(Taxon=factor(Taxon,levels=c(&quot;Amphibian&quot;,&quot;Reptile&quot;,&quot;Mammal&quot;,&quot;Bird&quot;,&quot;Control&quot;))) %&gt;% mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(aes(x=Extraction,y=damr))+ geom_boxplot() + facet_grid(. ~ Taxon, scales = &quot;free&quot;) + labs(y=&quot;Domain-adjusted mapping rate&quot;,x=&quot;Extraction method&quot;) all_data %&gt;% select(dataset,Extraction,microbial_fraction,MAG_mapping_percentage,Taxon, Sample, Species) %&gt;% mutate(damr=pmin(1,MAG_mapping_percentage/(microbial_fraction*100))) %&gt;% mutate(damr=ifelse(is.na(damr),0,damr)) %&gt;% unique() %&gt;% mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% lmerTest::lmer(damr ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %&gt;% broom.mixed::tidy() %&gt;% tt() tinytable_vkbc5i6m2y6f82drwgac .table td.tinytable_css_9ucwbjyqfrsckc9ahz6h, .table th.tinytable_css_9ucwbjyqfrsckc9ahz6h { border-bottom: solid 0.1em #d3d8dc; } effect group term estimate std.error statistic df p.value fixed NA (Intercept) 0.78271978 0.06660971 11.7508366 15.45687 4.117676e-09 fixed NA ExtractionDREX 0.03348421 0.03977983 0.8417385 130.19072 4.014779e-01 fixed NA ExtractionEHEX 0.02228400 0.03999367 0.5571881 130.24817 5.783552e-01 ran_pars Sample sd__(Intercept) 0.12024342 NA NA NA NA ran_pars Species sd__(Intercept) 0.19047224 NA NA NA NA ran_pars Residual sd__Observation 0.20283813 NA NA NA NA 5.4 Variance partitioning Variance partitioning metrics are derived from community_analysis.Rmd. variance_data &lt;- list.files(path = &quot;results&quot;, pattern = &quot;^var_.*\\\\.tsv$&quot;, full.names = TRUE) %&gt;% map_df(~ read_tsv(.)) variance_data %&gt;% summarise(mean=mean(r2),sd=sd(r2)) # A tibble: 1 × 2 mean sd &lt;dbl&gt; &lt;dbl&gt; 1 0.102 0.0768 variance_data %&gt;% left_join(sample_metadata %&gt;% select(Species,Taxon) %&gt;% unique(),by=join_by(species==Species)) %&gt;% mutate(metric=factor(metric,levels=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;))) %&gt;% mutate(Taxon=factor(Taxon,levels=c(&quot;Amphibian&quot;,&quot;Reptile&quot;,&quot;Mammal&quot;))) %&gt;% ggplot(aes(x=Taxon,y=r2)) + geom_boxplot()+ ylim(0,1)+ facet_grid(. ~ metric, scales = &quot;free&quot;) variance_data %&gt;% group_by(metric) %&gt;% summarise(mean=mean(r2),sd=sd(r2)) %&gt;% tt() tinytable_6v6g91e1qhtf8g46454r .table td.tinytable_css_41v2jup6awcmmwu7dro1, .table th.tinytable_css_41v2jup6awcmmwu7dro1 { border-bottom: solid 0.1em #d3d8dc; } metric mean sd neutral 0.06201935 0.04744380 phylogenetic 0.07381277 0.06884687 richness 0.16970818 0.06626388 5.5 Combined community analysis species=&quot;combined&quot; genus=species sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0134/DMB0134_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0134/DMB0134_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0134/DMB0134_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0134/DMB0134.tree.gz&quot;, &quot;data/DMB0134.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0134.tree.gz&quot;) 5.5.1 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 5.5.2 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts_filt %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Taxon + Species + Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank(), panel.spacing = unit(0, &quot;lines&quot;)) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) genome_counts_NMDS &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;, out=&quot;dist&quot;) %&gt;% metaMDS(.,trymax = 999, k=2, trace=0) %&gt;% vegan::scores() %&gt;% as_tibble(., rownames = &quot;dataset&quot;) %&gt;% left_join(sample_metadata, by = join_by(dataset == dataset)) %&gt;% filter(Taxon != &quot;Control&quot;) %&gt;% group_by(Sample) %&gt;% mutate(sample_x=mean(NMDS1), sample_y=mean(NMDS2)) genome_counts_NMDS %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=Species, shape=Extraction)) + scale_color_manual(values=c(&quot;#92d4d1&quot;,&quot;#9cba7b&quot;,&quot;#d9d88d&quot;,&quot;#40bfb8&quot;,&quot;#73a842&quot;,&quot;#c2c935&quot;,&quot;#bf7777&quot;,&quot;#4a7135&quot;,&quot;#25968e&quot;,&quot;#aa3333&quot;,&quot;#5e1717&quot;,&quot;#8d8e35&quot;)) + geom_point(size=3, alpha=0.8) + geom_segment(aes(x=sample_x, y=sample_y, xend=NMDS1, yend=NMDS2), alpha=0.2) + theme_classic() + theme(legend.position=&quot;right&quot;, legend.box=&quot;vertical&quot;) + guides(color=guide_legend(title=&quot;Species&quot;)) "],["amphibians.html", "6 Amphibians 6.1 Calotriton asper 6.2 Lissotriton helveticus 6.3 Salamandra atra", " 6 Amphibians 6.1 Calotriton asper 6.1.1 Retrieve data species=&quot;Calotriton asper&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0121/DMB0121_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0121/DMB0121_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0121/DMB0121_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0121/DMB0121.tree.gz&quot;, &quot;data/DMB0121.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0121.tree.gz&quot;) 6.1.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 6.1.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 6.1.4 Alpha diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=0) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(richness=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(neutral=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1,tree=genome_tree) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(phylogenetic=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) # Merge alpha diversities alpha_diversity &lt;- richness %&gt;% full_join(neutral,by=join_by(dataset==dataset)) %&gt;% full_join(phylogenetic,by=join_by(dataset==dataset)) # Write alpha diversities alpha_diversity %&gt;% write_tsv(paste0(&quot;results/alpha_&quot;,genus,&quot;.tsv&quot;)) # Print alpha diversity alpha_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(dataset==dataset)) %&gt;% group_by(Extraction) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_48iuyjocrltrkjlv60xr .table td.tinytable_css_j6trnjpqwszdjmlf97ny, .table th.tinytable_css_j6trnjpqwszdjmlf97ny { border-bottom: solid 0.1em #d3d8dc; } Extraction richness neutral phylogenetic DREX 107.0 51.75880 6.406283 EHEX 106.5 51.56757 6.311931 ZYMO 97.5 48.75158 6.219160 6.1.5 Beta diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;, out=&quot;pair&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;, out=&quot;pair&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;, out=&quot;pair&quot;) # Merge beta diversities beta_diversity &lt;- richness %&gt;% full_join(neutral,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% full_join(phylogenetic,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% rename(richness=C.x, neutral=C.y, phylogenetic=C) # Write beta diversities beta_diversity %&gt;% write_tsv(paste0(&quot;results/beta_&quot;,genus,&quot;.tsv&quot;)) # Print beta diversities beta_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(first==dataset)) %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(second==dataset)) %&gt;% mutate(relationship = case_when( Extraction.x == Extraction.y &amp; Sample.x != Sample.y ~ &quot;inter&quot;, Extraction.x != Extraction.y &amp; Sample.x == Sample.y ~ &quot;intra&quot;, TRUE ~ NA_character_ # Handle other cases if needed )) %&gt;% filter(relationship != is.na(relationship)) %&gt;% group_by(relationship) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_c2prh7g7usamc3zazh6j .table td.tinytable_css_hjwlm77kd2tp1pgvdiwl, .table th.tinytable_css_hjwlm77kd2tp1pgvdiwl { border-bottom: solid 0.1em #d3d8dc; } relationship richness neutral phylogenetic inter 0.29497046 0.381599435 0.105560612 intra 0.03215577 0.007477988 0.001740429 6.1.6 Variance partitioning richness &lt;-genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() tibble(species=rep(species,3),metric=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;),r2=c(richness,neutral,phylogenetic)) %&gt;% write_tsv(paste0(&quot;results/var_&quot;,genus,&quot;.tsv&quot;)) 6.2 Lissotriton helveticus 6.2.1 Retrieve data species=&quot;Lissotriton helveticus&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0124/DMB0124_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0124/DMB0124_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0124/DMB0124_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0124/DMB0124.tree.gz&quot;, &quot;data/DMB0124.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0124.tree.gz&quot;) 6.2.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 6.2.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 6.2.4 Alpha diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=0) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(richness=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(neutral=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1,tree=genome_tree) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(phylogenetic=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) # Merge alpha diversities alpha_diversity &lt;- richness %&gt;% full_join(neutral,by=join_by(dataset==dataset)) %&gt;% full_join(phylogenetic,by=join_by(dataset==dataset)) # Write alpha diversities alpha_diversity %&gt;% write_tsv(paste0(&quot;results/alpha_&quot;,genus,&quot;.tsv&quot;)) # Print alpha diversity alpha_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(dataset==dataset)) %&gt;% group_by(Extraction) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_d0720nb9l7wae8vie7is .table td.tinytable_css_g265js9p57q6q64wwfvl, .table th.tinytable_css_g265js9p57q6q64wwfvl { border-bottom: solid 0.1em #d3d8dc; } Extraction richness neutral phylogenetic DREX 22 12.05083 4.439034 EHEX 22 12.15999 4.408855 ZYMO 21 10.73360 3.336904 6.2.5 Beta diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;, out=&quot;pair&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;, out=&quot;pair&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;, out=&quot;pair&quot;) # Merge beta diversities beta_diversity &lt;- richness %&gt;% full_join(neutral,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% full_join(phylogenetic,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% rename(richness=C.x, neutral=C.y, phylogenetic=C) # Write beta diversities beta_diversity %&gt;% write_tsv(paste0(&quot;results/beta_&quot;,genus,&quot;.tsv&quot;)) # Print beta diversities beta_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(first==dataset)) %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(second==dataset)) %&gt;% mutate(relationship = case_when( Extraction.x == Extraction.y &amp; Sample.x != Sample.y ~ &quot;inter&quot;, Extraction.x != Extraction.y &amp; Sample.x == Sample.y ~ &quot;intra&quot;, TRUE ~ NA_character_ # Handle other cases if needed )) %&gt;% filter(relationship != is.na(relationship)) %&gt;% group_by(relationship) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_e61c73c4qauzd5119pe3 .table td.tinytable_css_f7hi3j8m2waf1g5fn9y0, .table th.tinytable_css_f7hi3j8m2waf1g5fn9y0 { border-bottom: solid 0.1em #d3d8dc; } relationship richness neutral phylogenetic inter 0.9090909 0.9487207 0.3681096 intra 0.2288066 0.1798833 0.1289869 6.2.6 Variance partitioning richness &lt;-genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() tibble(species=rep(species,3),metric=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;),r2=c(richness,neutral,phylogenetic)) %&gt;% write_tsv(paste0(&quot;results/var_&quot;,genus,&quot;.tsv&quot;)) 6.3 Salamandra atra 6.3.1 Retrieve data species=&quot;Salamandra atra&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0129/DMB0129_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0129/DMB0129_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0129/DMB0129_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0129/DMB0129.tree.gz&quot;, &quot;data/DMB0129.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0129.tree.gz&quot;) 6.3.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 6.3.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 6.3.4 Alpha diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=0) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(richness=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(neutral=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1,tree=genome_tree) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(phylogenetic=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) # Merge alpha diversities alpha_diversity &lt;- richness %&gt;% full_join(neutral,by=join_by(dataset==dataset)) %&gt;% full_join(phylogenetic,by=join_by(dataset==dataset)) # Write alpha diversities alpha_diversity %&gt;% write_tsv(paste0(&quot;results/alpha_&quot;,genus,&quot;.tsv&quot;)) # Print alpha diversity alpha_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(dataset==dataset)) %&gt;% group_by(Extraction) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_bcvw4zh2kb25wc33ij5l .table td.tinytable_css_7awhq4v7kx4bmsc2qyyo, .table th.tinytable_css_7awhq4v7kx4bmsc2qyyo { border-bottom: solid 0.1em #d3d8dc; } Extraction richness neutral phylogenetic DREX 70.0 35.33416 6.024485 EHEX 84.0 38.29817 6.183859 ZYMO 58.5 30.15278 5.653610 6.3.5 Beta diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;, out=&quot;pair&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;, out=&quot;pair&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;, out=&quot;pair&quot;) # Merge beta diversities beta_diversity &lt;- richness %&gt;% full_join(neutral,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% full_join(phylogenetic,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% rename(richness=C.x, neutral=C.y, phylogenetic=C) # Write beta diversities beta_diversity %&gt;% write_tsv(paste0(&quot;results/beta_&quot;,genus,&quot;.tsv&quot;)) # Print beta diversities beta_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(first==dataset)) %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(second==dataset)) %&gt;% mutate(relationship = case_when( Extraction.x == Extraction.y &amp; Sample.x != Sample.y ~ &quot;inter&quot;, Extraction.x != Extraction.y &amp; Sample.x == Sample.y ~ &quot;intra&quot;, TRUE ~ NA_character_ # Handle other cases if needed )) %&gt;% filter(relationship != is.na(relationship)) %&gt;% group_by(relationship) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_z0tb07a2acqhhdbrlqqe .table td.tinytable_css_4t4u8koos3cuzqlh4ivk, .table th.tinytable_css_4t4u8koos3cuzqlh4ivk { border-bottom: solid 0.1em #d3d8dc; } relationship richness neutral phylogenetic inter 0.3854701 0.3862921 0.125862853 intra 0.1422510 0.0315443 0.007370115 6.3.6 Variance partitioning richness &lt;-genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() tibble(species=rep(species,3),metric=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;),r2=c(richness,neutral,phylogenetic)) %&gt;% write_tsv(paste0(&quot;results/var_&quot;,genus,&quot;.tsv&quot;)) "],["birds.html", "7 Birds 7.1 Geospizopsis unicolor 7.2 Perisoreus infaustus 7.3 Zonotrichia capensis", " 7 Birds 7.1 Geospizopsis unicolor 7.1.1 Retrieve data species=&quot;Geospizopsis unicolor&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0123/DMB0123_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0123/DMB0123_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0123/DMB0123_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0123/DMB0123.tree.gz&quot;, &quot;data/DMB0123.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0123.tree.gz&quot;) 7.1.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 7.1.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 7.1.4 Alpha diversity Alpha diversity is not calculated as only one sample contains enough genome coverage to calculate diversity estimates. 7.1.5 Beta diversity Beta diversity is not calculated as only one sample contains enough genome coverage to calculate diversity estimates. 7.2 Perisoreus infaustus 7.2.1 Retrieve data species=&quot;Perisoreus infaustus&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0126/DMB0126_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0126/DMB0126_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0126/DMB0126_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0126/DMB0126.tree.gz&quot;, &quot;data/DMB0126.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0126.tree.gz&quot;) 7.2.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 7.2.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 7.2.4 Alpha diversity Alpha diversity is not calculated as only one sample contains enough genome coverage to calculate diversity estimates. 7.2.5 Beta diversity Beta diversity is not calculated as only one sample contains enough genome coverage to calculate diversity estimates. 7.3 Zonotrichia capensis The number of reconstructed genomes was too low for community analyses. "],["mammals.html", "8 Mammals 8.1 Plecotus auritus 8.2 Sciurus carolinensis 8.3 Trichosurus vulpecula", " 8 Mammals 8.1 Plecotus auritus 8.1.1 Retrieve data species=&quot;Plecotus auritus&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0127/DMB0127_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0127/DMB0127_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0127/DMB0127_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0127/DMB0127.tree.gz&quot;, &quot;data/DMB0127.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0127.tree.gz&quot;) 8.1.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 8.1.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 8.1.4 Alpha diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=0) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(richness=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(neutral=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1,tree=genome_tree) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(phylogenetic=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) # Merge alpha diversities alpha_diversity &lt;- richness %&gt;% full_join(neutral,by=join_by(dataset==dataset)) %&gt;% full_join(phylogenetic,by=join_by(dataset==dataset)) # Write alpha diversities alpha_diversity %&gt;% write_tsv(paste0(&quot;results/alpha_&quot;,genus,&quot;.tsv&quot;)) # Print alpha diversity alpha_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(dataset==dataset)) %&gt;% group_by(Extraction) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_9r8pr6ci9aqzuvkquvj4 .table td.tinytable_css_0ou06533d94k71vq6dyh, .table th.tinytable_css_0ou06533d94k71vq6dyh { border-bottom: solid 0.1em #d3d8dc; } Extraction richness neutral phylogenetic DREX 12.5 5.070885 2.691939 EHEX 11.5 5.348040 2.739107 ZYMO 6.5 4.042292 2.282549 8.1.5 Beta diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;, out=&quot;pair&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;, out=&quot;pair&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;, out=&quot;pair&quot;) # Merge beta diversities beta_diversity &lt;- richness %&gt;% full_join(neutral,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% full_join(phylogenetic,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% rename(richness=C.x, neutral=C.y, phylogenetic=C) # Write beta diversities beta_diversity %&gt;% write_tsv(paste0(&quot;results/beta_&quot;,genus,&quot;.tsv&quot;)) # Print beta diversities beta_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(first==dataset)) %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(second==dataset)) %&gt;% mutate(relationship = case_when( Extraction.x == Extraction.y &amp; Sample.x != Sample.y ~ &quot;inter&quot;, Extraction.x != Extraction.y &amp; Sample.x == Sample.y ~ &quot;intra&quot;, TRUE ~ NA_character_ # Handle other cases if needed )) %&gt;% filter(relationship != is.na(relationship)) %&gt;% group_by(relationship) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_sjvxbkr87mab86nbv9ae .table td.tinytable_css_qqa0x1p9xlav3i7c12l6, .table th.tinytable_css_qqa0x1p9xlav3i7c12l6 { border-bottom: solid 0.1em #d3d8dc; } relationship richness neutral phylogenetic inter 0.6727759 0.82731396 0.68954392 intra 0.2123748 0.03113448 0.01336019 8.1.6 Variance partitioning richness &lt;-genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() tibble(species=rep(species,3),metric=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;),r2=c(richness,neutral,phylogenetic)) %&gt;% write_tsv(paste0(&quot;results/var_&quot;,genus,&quot;.tsv&quot;)) 8.2 Sciurus carolinensis 8.2.1 Retrieve data species=&quot;Sciurus carolinensis&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0130/DMB0130_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0130/DMB0130_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0130/DMB0130_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0130/DMB0130.tree.gz&quot;, &quot;data/DMB0130.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0130.tree.gz&quot;) 8.2.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 8.2.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 8.2.4 Alpha diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=0) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(richness=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(neutral=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1,tree=genome_tree) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(phylogenetic=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) # Merge alpha diversities alpha_diversity &lt;- richness %&gt;% full_join(neutral,by=join_by(dataset==dataset)) %&gt;% full_join(phylogenetic,by=join_by(dataset==dataset)) # Write alpha diversities alpha_diversity %&gt;% write_tsv(paste0(&quot;results/alpha_&quot;,genus,&quot;.tsv&quot;)) # Print alpha diversity alpha_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(dataset==dataset)) %&gt;% group_by(Extraction) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_oqprp8sgpt46lajfi8of .table td.tinytable_css_x2siwrs9lg46fdh7r7vx, .table th.tinytable_css_x2siwrs9lg46fdh7r7vx { border-bottom: solid 0.1em #d3d8dc; } Extraction richness neutral phylogenetic DREX 95.0 39.66320 5.557244 EHEX 96.0 47.74310 5.728024 ZYMO 107.5 59.13437 6.138243 8.2.5 Beta diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;, out=&quot;pair&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;, out=&quot;pair&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;, out=&quot;pair&quot;) # Merge beta diversities beta_diversity &lt;- richness %&gt;% full_join(neutral,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% full_join(phylogenetic,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% rename(richness=C.x, neutral=C.y, phylogenetic=C) # Write beta diversities beta_diversity %&gt;% write_tsv(paste0(&quot;results/beta_&quot;,genus,&quot;.tsv&quot;)) # Print beta diversities beta_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(first==dataset)) %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(second==dataset)) %&gt;% mutate(relationship = case_when( Extraction.x == Extraction.y &amp; Sample.x != Sample.y ~ &quot;inter&quot;, Extraction.x != Extraction.y &amp; Sample.x == Sample.y ~ &quot;intra&quot;, TRUE ~ NA_character_ # Handle other cases if needed )) %&gt;% filter(relationship != is.na(relationship)) %&gt;% group_by(relationship) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_favyjqfzjd8grkr90py2 .table td.tinytable_css_qmge1o7hnxilidzii0vl, .table th.tinytable_css_qmge1o7hnxilidzii0vl { border-bottom: solid 0.1em #d3d8dc; } relationship richness neutral phylogenetic inter 0.4447768 0.6554629 0.19033972 intra 0.1823044 0.1211974 0.03562178 8.2.6 Variance partitioning richness &lt;-genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() tibble(species=rep(species,3),metric=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;),r2=c(richness,neutral,phylogenetic)) %&gt;% write_tsv(paste0(&quot;results/var_&quot;,genus,&quot;.tsv&quot;)) 8.3 Trichosurus vulpecula 8.3.1 Retrieve data species=&quot;Trichosurus vulpecula&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0131/DMB0131_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0131/DMB0131_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0131/DMB0131_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0131/DMB0131.tree.gz&quot;, &quot;data/DMB0131.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0131.tree.gz&quot;) 8.3.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 8.3.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 8.3.4 Alpha diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=0) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(richness=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(neutral=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1,tree=genome_tree) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(phylogenetic=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) # Merge alpha diversities alpha_diversity &lt;- richness %&gt;% full_join(neutral,by=join_by(dataset==dataset)) %&gt;% full_join(phylogenetic,by=join_by(dataset==dataset)) # Write alpha diversities alpha_diversity %&gt;% write_tsv(paste0(&quot;results/alpha_&quot;,genus,&quot;.tsv&quot;)) # Print alpha diversity alpha_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(dataset==dataset)) %&gt;% group_by(Extraction) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_xq1eloql4vudj276cukx .table td.tinytable_css_vrkjgvkvpjjxjuom3n9g, .table th.tinytable_css_vrkjgvkvpjjxjuom3n9g { border-bottom: solid 0.1em #d3d8dc; } Extraction richness neutral phylogenetic DREX 50.5 21.91494 5.924827 EHEX 72.0 28.43487 7.338228 ZYMO 67.5 28.14959 6.253726 8.3.5 Beta diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;, out=&quot;pair&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;, out=&quot;pair&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;, out=&quot;pair&quot;) # Merge beta diversities beta_diversity &lt;- richness %&gt;% full_join(neutral,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% full_join(phylogenetic,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% rename(richness=C.x, neutral=C.y, phylogenetic=C) # Write beta diversities beta_diversity %&gt;% write_tsv(paste0(&quot;results/beta_&quot;,genus,&quot;.tsv&quot;)) # Print beta diversities beta_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(first==dataset)) %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(second==dataset)) %&gt;% mutate(relationship = case_when( Extraction.x == Extraction.y &amp; Sample.x != Sample.y ~ &quot;inter&quot;, Extraction.x != Extraction.y &amp; Sample.x == Sample.y ~ &quot;intra&quot;, TRUE ~ NA_character_ # Handle other cases if needed )) %&gt;% filter(relationship != is.na(relationship)) %&gt;% group_by(relationship) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_oxjxv6hiy9z8xniom4uq .table td.tinytable_css_ehz8ja2pne9ynqysi9yg, .table th.tinytable_css_ehz8ja2pne9ynqysi9yg { border-bottom: solid 0.1em #d3d8dc; } relationship richness neutral phylogenetic inter 0.3673634 0.55492808 0.26261760 intra 0.1050321 0.02750575 0.01017398 8.3.6 Variance partitioning Variance partitioning was not conducted because EHI02106 failed to yield any data. "],["reptiles.html", "9 Reptiles 9.1 Chalcides striatus 9.2 Natrix astreptophora 9.3 Podarcis muralis", " 9 Reptiles 9.1 Chalcides striatus 9.1.1 Retrieve data species=&quot;Chalcides striatus&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0122/DMB0122_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0122/DMB0122_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0122/DMB0122_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0122/DMB0122.tree.gz&quot;, &quot;data/DMB0122.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0122.tree.gz&quot;) 9.1.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 9.1.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 9.1.4 Alpha diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=0) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(richness=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(neutral=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1,tree=genome_tree) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(phylogenetic=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) # Merge alpha diversities alpha_diversity &lt;- richness %&gt;% full_join(neutral,by=join_by(dataset==dataset)) %&gt;% full_join(phylogenetic,by=join_by(dataset==dataset)) # Write alpha diversities alpha_diversity %&gt;% write_tsv(paste0(&quot;results/alpha_&quot;,genus,&quot;.tsv&quot;)) # Print alpha diversity alpha_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(dataset==dataset)) %&gt;% group_by(Extraction) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_6bedon2hantzx2abf7bj .table td.tinytable_css_tfkr3frspn8zmv5w9ee3, .table th.tinytable_css_tfkr3frspn8zmv5w9ee3 { border-bottom: solid 0.1em #d3d8dc; } Extraction richness neutral phylogenetic DREX 60.5 31.68716 5.314585 EHEX 64.5 34.15145 5.180680 ZYMO 74.0 37.04400 5.254353 9.1.5 Beta diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;, out=&quot;pair&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;, out=&quot;pair&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;, out=&quot;pair&quot;) # Merge beta diversities beta_diversity &lt;- richness %&gt;% full_join(neutral,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% full_join(phylogenetic,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% rename(richness=C.x, neutral=C.y, phylogenetic=C) # Write beta diversities beta_diversity %&gt;% write_tsv(paste0(&quot;results/beta_&quot;,genus,&quot;.tsv&quot;)) # Print beta diversities beta_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(first==dataset)) %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(second==dataset)) %&gt;% mutate(relationship = case_when( Extraction.x == Extraction.y &amp; Sample.x != Sample.y ~ &quot;inter&quot;, Extraction.x != Extraction.y &amp; Sample.x == Sample.y ~ &quot;intra&quot;, TRUE ~ NA_character_ # Handle other cases if needed )) %&gt;% filter(relationship != is.na(relationship)) %&gt;% group_by(relationship) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_ewj6ku9mn8qs7dhui2sz .table td.tinytable_css_anw6i23xm385fearnuih, .table th.tinytable_css_anw6i23xm385fearnuih { border-bottom: solid 0.1em #d3d8dc; } relationship richness neutral phylogenetic inter 0.4109306 0.45373698 0.09334837 intra 0.1286148 0.06449944 0.02626687 9.1.6 Variance partitioning richness &lt;-genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() tibble(species=rep(species,3),metric=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;),r2=c(richness,neutral,phylogenetic)) %&gt;% write_tsv(paste0(&quot;results/var_&quot;,genus,&quot;.tsv&quot;)) 9.2 Natrix astreptophora 9.2.1 Retrieve data species=&quot;Natrix astreptophora&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0125/DMB0125_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0125/DMB0125_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0125/DMB0125_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0125/DMB0125.tree.gz&quot;, &quot;data/DMB0125.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0125.tree.gz&quot;) 9.2.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 9.2.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 9.2.4 Alpha diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=0) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(richness=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(neutral=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1,tree=genome_tree) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(phylogenetic=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) # Merge alpha diversities alpha_diversity &lt;- richness %&gt;% full_join(neutral,by=join_by(dataset==dataset)) %&gt;% full_join(phylogenetic,by=join_by(dataset==dataset)) # Write alpha diversities alpha_diversity %&gt;% write_tsv(paste0(&quot;results/alpha_&quot;,genus,&quot;.tsv&quot;)) # Print alpha diversity alpha_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(dataset==dataset)) %&gt;% group_by(Extraction) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_n65gs2hs1x3kheg61ace .table td.tinytable_css_mxb2pjefr755ekhcyh7n, .table th.tinytable_css_mxb2pjefr755ekhcyh7n { border-bottom: solid 0.1em #d3d8dc; } Extraction richness neutral phylogenetic DREX 37.5 16.30449 3.270384 EHEX 29.5 15.34095 3.211162 ZYMO 24.0 13.43764 3.065722 9.2.5 Beta diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;, out=&quot;pair&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;, out=&quot;pair&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;, out=&quot;pair&quot;) # Merge beta diversities beta_diversity &lt;- richness %&gt;% full_join(neutral,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% full_join(phylogenetic,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% rename(richness=C.x, neutral=C.y, phylogenetic=C) # Write beta diversities beta_diversity %&gt;% write_tsv(paste0(&quot;results/beta_&quot;,genus,&quot;.tsv&quot;)) # Print beta diversities beta_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(first==dataset)) %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(second==dataset)) %&gt;% mutate(relationship = case_when( Extraction.x == Extraction.y &amp; Sample.x != Sample.y ~ &quot;inter&quot;, Extraction.x != Extraction.y &amp; Sample.x == Sample.y ~ &quot;intra&quot;, TRUE ~ NA_character_ # Handle other cases if needed )) %&gt;% filter(relationship != is.na(relationship)) %&gt;% group_by(relationship) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_r7kwcqx2gwtw34wslenq .table td.tinytable_css_n6ci5646io8qamgui88i, .table th.tinytable_css_n6ci5646io8qamgui88i { border-bottom: solid 0.1em #d3d8dc; } relationship richness neutral phylogenetic inter 0.5386629 0.65025916 0.18128644 intra 0.2756370 0.04665216 0.01166948 9.2.6 Variance partitioning richness &lt;-genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() tibble(species=rep(species,3),metric=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;),r2=c(richness,neutral,phylogenetic)) %&gt;% write_tsv(paste0(&quot;results/var_&quot;,genus,&quot;.tsv&quot;)) 9.3 Podarcis muralis 9.3.1 Retrieve data species=&quot;Podarcis muralis&quot; genus=strsplit(species, &quot; &quot;)[[1]][1] %&gt;% tolower() sample_metadata &lt;- read_tsv(paste0(&quot;data/metadata.tsv&quot;)) %&gt;% rename(dataset=Dataset) %&gt;% filter(Species == species) read_counts &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0128/DMB0128_counts.tsv.gz&quot;) %&gt;% rename(genome = 1) genome_metadata &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0128/DMB0128_mag_info.tsv.gz&quot;) %&gt;% rename(genome = 1, length=mag_size) genome_coverage &lt;- read_tsv(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0128/DMB0128_coverage.tsv.gz&quot;) %&gt;% rename(genome = 1) download.file(&quot;https://sid.erda.dk/share_redirect/BaMZodj9sA/DMB/DMB0128/DMB0128.tree.gz&quot;, &quot;data/DMB0128.tree.gz&quot;) genome_tree &lt;- read_tree(&quot;data/DMB0128.tree.gz&quot;) 9.3.2 Filter data #Filter by coverage min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) # Transform to genome counts (non-filtered) readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) # Transform to genome counts (coverage-filtered) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 9.3.3 Community barplot # Retrieve EHI taxonomy colors phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% select(colors) %&gt;% pull() # Stacked barplot genome_counts %&gt;% mutate_at(vars(-genome), funs(./sum(., na.rm = TRUE))) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;dataset&quot;, values_to = &quot;count&quot;) %&gt;% left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append taxonomy left_join(., sample_metadata, by = join_by(dataset == dataset)) %&gt;% #append taxonomy mutate(Extraction=factor(Extraction,levels=c(&quot;ZYMO&quot;,&quot;DREX&quot;,&quot;EHEX&quot;))) %&gt;% ggplot(., aes(x=dataset,y=count,fill=phylum, group=phylum))+ #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1)+ #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + labs(y = &quot;Relative abundance&quot;) + facet_nested(. ~ Sample + Extraction, scales=&quot;free_x&quot;) + guides(fill = guide_legend(ncol = 3)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position=&quot;none&quot;, legend.title=element_blank()) ggsave(paste0(&quot;figures/barplot_&quot;,genus,&quot;.pdf&quot;)) 9.3.4 Alpha diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=0) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(richness=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(neutral=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hilldiv(.,q=1,tree=genome_tree) %&gt;% t() %&gt;% as.data.frame() %&gt;% rename(phylogenetic=1) %&gt;% rownames_to_column(var=&quot;dataset&quot;) # Merge alpha diversities alpha_diversity &lt;- richness %&gt;% full_join(neutral,by=join_by(dataset==dataset)) %&gt;% full_join(phylogenetic,by=join_by(dataset==dataset)) # Write alpha diversities alpha_diversity %&gt;% write_tsv(paste0(&quot;results/alpha_&quot;,genus,&quot;.tsv&quot;)) # Print alpha diversity alpha_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(dataset==dataset)) %&gt;% group_by(Extraction) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_644kzso9r95ljzbcn8ln .table td.tinytable_css_y7ozblb100wonnfly1hy, .table th.tinytable_css_y7ozblb100wonnfly1hy { border-bottom: solid 0.1em #d3d8dc; } Extraction richness neutral phylogenetic DREX 80.5 33.09492 4.689994 EHEX 73.0 32.71816 4.716865 ZYMO 78.5 34.42602 4.745518 9.3.5 Beta diversity #Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;, out=&quot;pair&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;, out=&quot;pair&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;, out=&quot;pair&quot;) # Merge beta diversities beta_diversity &lt;- richness %&gt;% full_join(neutral,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% full_join(phylogenetic,by=c(&quot;first&quot;, &quot;second&quot;)) %&gt;% rename(richness=C.x, neutral=C.y, phylogenetic=C) # Write beta diversities beta_diversity %&gt;% write_tsv(paste0(&quot;results/beta_&quot;,genus,&quot;.tsv&quot;)) # Print beta diversities beta_diversity %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(first==dataset)) %&gt;% left_join(sample_metadata %&gt;% select(dataset,Extraction,Sample),by=join_by(second==dataset)) %&gt;% mutate(relationship = case_when( Extraction.x == Extraction.y &amp; Sample.x != Sample.y ~ &quot;inter&quot;, Extraction.x != Extraction.y &amp; Sample.x == Sample.y ~ &quot;intra&quot;, TRUE ~ NA_character_ # Handle other cases if needed )) %&gt;% filter(relationship != is.na(relationship)) %&gt;% group_by(relationship) %&gt;% summarise(richness=mean(richness), neutral=mean(neutral), phylogenetic=mean(phylogenetic)) %&gt;% tt() tinytable_zpzvbh01ydodnqn4g65y .table td.tinytable_css_wgtszgzxd7ufj7thbitj, .table th.tinytable_css_wgtszgzxd7ufj7thbitj { border-bottom: solid 0.1em #d3d8dc; } relationship richness neutral phylogenetic inter 0.2864067 0.41508917 0.122770382 intra 0.0446703 0.00905735 0.003367558 9.3.6 Variance partitioning richness &lt;-genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=0, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;) %&gt;% select(where(~!all(. == 0))) %&gt;% hillpair(.,q=1, tree=genome_tree, metric=&quot;C&quot;) %&gt;% as.dist() %&gt;% adonis2(formula = . ~ Sample + Extraction, data = sample_metadata %&gt;% arrange(match(dataset,colnames(genome_counts_filt))), permutations = 999, method = &quot;bray&quot;, sqrt.dist = TRUE) %&gt;% broom::tidy() %&gt;% filter(term == &quot;Extraction&quot;) %&gt;% select(R2) %&gt;% pull() tibble(species=rep(species,3),metric=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;),r2=c(richness,neutral,phylogenetic)) %&gt;% write_tsv(paste0(&quot;results/var_&quot;,genus,&quot;.tsv&quot;)) "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
