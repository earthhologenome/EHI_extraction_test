# Sequencing data

## Sequencing depth

```{r sequencing_depth_overview, warning=FALSE, comments="", message=FALSE}

tibble(metric=c("Total GB", "Total reads", "Average GB", "Average reads"),
       value=unlist(c(round(all_data %>% summarise(sum(bases_pre_fastp)) / 1000000000,2),
               round(all_data %>% summarise(sum(bases_pre_fastp)) / 300,2),
               paste0(round(all_data %>% summarise(mean(bases_pre_fastp)) / 1000000000,2),"Â±",round(all_data %>% summarise(sd(bases_pre_fastp)) / 1000000000,2)),
               paste0(round(all_data %>% summarise(mean(bases_pre_fastp)) / 300,0),"Â±",round(all_data %>% summarise(sd(bases_pre_fastp)) / 300,0))))
       ) %>%
  tt()

```

```{r sequencing_depth_summary, warning=FALSE, comments="", message=FALSE}
all_data %>%
    group_by(Taxon,Extraction) %>%
    summarise(value = sprintf("%.1fÂ±%.1f", mean(bases_post_fastp / 1000000000), sd(bases_post_fastp / 1000000000))) %>%
    pivot_wider(names_from = Extraction, values_from = value) %>%
    tt(caption = "Mean and standard deviation of sequencing depth (GB)")
```

```{r sequencing_depth_plot, warning=FALSE, comments="", message=FALSE, fig.height=4, fig.width=10, fig.fullwidth=TRUE}
all_data %>%
    ggplot(aes(x=Extraction,y=bases_pre_fastp))+ 
        geom_boxplot() + 
        facet_grid(. ~ Taxon, scales = "free") +
        labs(y="DNA yield (ng)",x="Extraction method")
```

```{r sequencing_depth_test, warning=FALSE, comments="", message=FALSE}
all_data  %>%
    filter(Taxon != "Control") %>%
    lmerTest::lmer(bases_post_fastp ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %>%
    broom.mixed::tidy() %>%
    tt()
```

## Quality-filtering

```{r qc_summary, warning=FALSE, comments="", message=FALSE}
all_data %>%
    mutate(qf_bases=bases_post_fastp/bases_pre_fastp*100) %>%
    group_by(Taxon,Extraction) %>%
    summarise(value = sprintf("%.1fÂ±%.1f", mean(qf_bases), sd(qf_bases))) %>%
    pivot_wider(names_from = Extraction, values_from = value) %>%
    tt(caption = "Mean and standard deviation of quality-filtered proportion of reads")
```

```{r qc_plot, warning=FALSE, comments="", message=FALSE, fig.height=4, fig.width=10, fig.fullwidth=TRUE}
all_data %>%
    mutate(qf_bases=bases_post_fastp/bases_pre_fastp*100) %>%
    ggplot(aes(x=Extraction,y=qf_bases))+ 
        geom_boxplot() + 
        facet_grid(. ~ Taxon, scales = "free") +
        labs(y="DNA yield (ng)",x="Extraction method")
```

```{r qc_test, warning=FALSE, comments="", message=FALSE}
all_data  %>%
    mutate(qf_bases=bases_post_fastp/bases_pre_fastp*100) %>%
    filter(Taxon != "Control") %>%
    lmerTest::lmer(qf_bases ~ Extraction + (1 | Sample) + (1 | Species), data = ., REML = FALSE) %>%
    broom.mixed::tidy() %>%
    tt()
```

